import{f as H,ax as X,aw as V,r as u,g as Z,h as J,j as e,F as W,i as C,k as w,l as S,n as I,I as ee,o as A,Q as B,R as D,e as f,p as h,T as P,V as Y,X as T,Y as _,Z as L,_ as U,$ as K,a0 as O,u as ae,a as se,at as re,a9 as te,P as ne,s as oe,v as le,w as ce,C as de,m as ie,D as me,x as $}from"./index-BEfPUQd3.js";import{u as ue}from"./modal-helpers-u5ghZSiS.js";import{u as xe}from"./useMutation-CxnX3va-.js";import{m as he,u as pe}from"./modelsQueries-CAzdMLFP.js";import{s as fe}from"./zod-DPUoip6C.js";import{o as z,a as je,n as ge,s as q}from"./index-3Gi9B8Cu.js";import{C as be}from"./chevrons-up-down-BEyfiSas.js";import{C as G}from"./calendar-ubeMVyQ8.js";import{T as ye}from"./trash-2-DQhLckhX.js";import{P as Q}from"./plus-D6nxsE-o.js";import"./dialog-DfEuW_jS.js";const Me=()=>{const j=H();return xe({mutationFn:n=>X.createCarModel(n),onSuccess:()=>{j.invalidateQueries({queryKey:he.all})}})},Ne=z({name:q().min(1,"Model name is required"),carBrand_ID:q().min(1,"Car brand ID is required"),yearOfMake:ge().min(1900,"Year must be 1900 or later").max(new Date().getFullYear()+1,"Year cannot be in the future")}),ve=z({models:je(Ne).min(1,"Add at least one model")});function Ce({onSubmit:j,loading:n=!1}){const{data:p}=V(),g=u.useMemo(()=>(p==null?void 0:p.brands)||[],[p]),d=u.useMemo(()=>g.map(o=>({id:o.CarBrand_ID,name:o.name})),[g]),y=u.useMemo(()=>{const o=new Date().getFullYear(),l=[];for(let a=o+1;a>=1900;a--)l.push(a);return l},[]),i=Z({resolver:fe(ve),defaultValues:{models:[{name:"",carBrand_ID:"",yearOfMake:new Date().getFullYear()}]}}),{fields:x,append:M,remove:N}=J({control:i.control,name:"models"}),r=o=>{j(o.models),i.reset()};return e.jsx(W,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:x.map((o,l)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(C,{control:i.control,name:`models.${l}.name`,render:({field:a})=>e.jsxs(w,{children:[e.jsx(S,{className:"text-gray-700",children:"Model Name"}),e.jsx(I,{children:e.jsx(ee,{placeholder:"Enter model name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:n,...a})}),e.jsx(A,{className:"text-red-500"})]})}),e.jsx(C,{control:i.control,name:`models.${l}.carBrand_ID`,render:({field:a})=>{var c;return e.jsxs(w,{children:[e.jsx(S,{className:"text-gray-700",children:"Car Brand"}),e.jsxs(B,{children:[e.jsx(D,{asChild:!0,children:e.jsx(I,{children:e.jsxs(f,{variant:"outline",role:"combobox",className:h("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!a.value&&"text-muted-foreground"),disabled:n,children:[a.value?(c=d.find(m=>m.id===a.value))==null?void 0:c.name:"Select car brand...",e.jsx(be,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(P,{className:"w-full p-0",children:e.jsxs(Y,{children:[e.jsx(T,{placeholder:"Search car brand..."}),e.jsxs(_,{children:[e.jsx(L,{children:"No car brand found."}),e.jsx(U,{children:d.map(m=>e.jsxs(K,{value:m.name,onSelect:()=>{a.onChange(m.id)},children:[e.jsx(O,{className:h("mr-2 h-4 w-4",m.id===a.value?"opacity-100":"opacity-0")}),m.name]},m.id))})]})]})})]}),e.jsx(A,{className:"text-red-500"})]})}}),e.jsx(C,{control:i.control,name:`models.${l}.yearOfMake`,render:({field:a})=>e.jsxs(w,{children:[e.jsx(S,{className:"text-gray-700",children:"Year of Make"}),e.jsxs(B,{children:[e.jsx(D,{asChild:!0,children:e.jsx(I,{children:e.jsxs(f,{variant:"outline",role:"combobox",className:h("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!a.value&&"text-muted-foreground"),disabled:n,children:[a.value?a.value.toString():"Select year...",e.jsx(G,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(P,{className:"w-full p-0",children:e.jsxs(Y,{children:[e.jsx(T,{placeholder:"Search year..."}),e.jsxs(_,{children:[e.jsx(L,{children:"No year found."}),e.jsx(U,{children:y.map(c=>e.jsxs(K,{value:c.toString(),onSelect:()=>{a.onChange(c)},children:[e.jsx(O,{className:h("mr-2 h-4 w-4",c===a.value?"opacity-100":"opacity-0")}),c]},c))})]})]})})]}),e.jsx(A,{className:"text-red-500"})]})})]}),x.length>1&&e.jsx(f,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>N(l),disabled:n,children:e.jsx(ye,{className:"w-4 h-4 text-gray-600"})})]},o.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(f,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>M({name:"",carBrand_ID:"",yearOfMake:new Date().getFullYear()}),disabled:n,children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(f,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:n,children:n?"Saving...":"Save Models"})]})]})})}function Te(){const[j,n]=u.useState(!1),p=Me(),g=ue(),{data:d,isLoading:y,isError:i}=pe(),x=u.useMemo(()=>(d==null?void 0:d.data)||[],[d==null?void 0:d.data]),M=async s=>{n(!0);try{await p.mutateAsync(s),$.success(`${s.length} model(s) created successfully`),g.close()}catch(t){console.error("Error creating models:",t),$.error("Failed to create models. Please try again.")}finally{n(!1)}},N=()=>{g.openForm({title:"Add Vehicle Models",size:"md",showFooter:!1,children:e.jsx(Ce,{onSubmit:M,loading:j})})},{data:r,isLoading:o}=V();u.useEffect(()=>{const s=ae.getState().actions.loadInventoryData;s()},[]);const l=u.useMemo(()=>r!=null&&r.manufacturers?new Map(r.manufacturers.map(s=>[s.Manufacturer_ID,s])):new Map,[r==null?void 0:r.manufacturers]),a=u.useCallback(s=>{const t=l.get(s);return(t==null?void 0:t.name)||s||"Unknown"},[l]),c=u.useMemo(()=>[{header:"Name of Model",accessorKey:"name"},{header:"Manufacturer",accessorKey:"carBrand.manufacturer_ID",cell:({row:s})=>{var E,k;const t=(E=s.original.carBrand)==null?void 0:E.manufacturer_ID,b=a(t||""),R=o&&!(r!=null&&r.manufacturers),v=b===t;return console.log("Debug Models Manufacturer:",{modelName:s.original.name,carBrand:s.original.carBrand,manufacturerId:t,manufacturerName:b,availableManufacturers:((k=r==null?void 0:r.manufacturers)==null?void 0:k.map(F=>({id:F.Manufacturer_ID,name:F.name})))||[],lookupResult:l.get(t||"")}),R?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}):t?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:h("font-medium",v?"text-amber-600":"text-gray-900"),title:v?`ID: ${t}`:b,children:b}),v&&e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",t]})]}):e.jsx("span",{className:"text-gray-400",children:"No manufacturer"})}},{header:"Status",accessorKey:"status",cell:({row:s})=>{const t=s.original.status===1;return e.jsxs("span",{className:h("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",t?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:h("w-1.5 h-1.5 rounded-full mr-1.5",t?"bg-green-400":"bg-red-400")}),t?"Active":"Inactive"]})}},{header:"Year of Make",accessorKey:"yearOfMake"}],[a,r==null?void 0:r.manufacturers,o]),m=[{title:"Total Models",value:x.length,Icon:se,description:"Active car models in the system",trend:"+3.2%",trendUp:!0},{title:"Latest Year",value:x.length>0?Math.max(...x.map(s=>s.yearOfMake)):0,Icon:G,description:"Most recent model year",trend:"+1.5%",trendUp:!0},{title:"Manufacturers",value:new Set(x.map(s=>s.carBrand_ID)).size,Icon:re,description:"Associated manufacturers",trend:"+2.8%",trendUp:!0},{title:"Parts Categories",value:89,Icon:te,description:"Compatible parts categories",trend:"+4.1%",trendUp:!0}];return y?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(ne,{})}):i?e.jsx("div",{children:"Error loading models"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(oe,{items:le.threeTier("Inventory","/inventory","Models")}),e.jsx(ce,{title:"Vehicle Models",description:"Manage vehicle models and their specifications",actions:e.jsxs(f,{onClick:N,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Add Model"]})}),e.jsx(de,{cards:m}),e.jsx(ie.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(me,{columns:c,data:x,placeholder:"Search models...",tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{Te as default};
