import{A as u,i as J,k as Q,j as e,a as y,r as x,w as L,h as Y,g as T,W as S,aa as Z,ab as ee,ac as se,ad as ae,ae as I,af as re,l as te,m as le,R as B}from"./index-CG3cDFil.js";import{u as P,B as ne,a as ce,P as ie}from"./pageHeader-DU7bLt5i.js";import{D as oe}from"./index-DVvBrNmU.js";import{C as de}from"./card-grid-DHAopdjS.js";import{u as R,F as K,b as _,c as U,d as me,e as C,f as V}from"./form-_i_eYalU.js";import{u as ue}from"./useMutation-CVaQmNh4.js";import{u as he}from"./useQuery-Nb54E3uG.js";import{s as $,o as xe,e as pe,z as D}from"./index-Cksdco4c.js";import{S as k,a as H,b as q,c as G,d as b}from"./select-xgui-4X2.js";import{B as w}from"./badge-CWZmtTXQ.js";import{P as ye,a as je,b as ge,C as be,c as Ne,e as fe,f as Ee,g as we}from"./popover-P3KGh40z.js";import{I as Ce}from"./input-0St3XTHq.js";import{C as Se}from"./chevrons-up-down-BKctIM13.js";import{C as M}from"./credit-card-z-KNPR6a.js";import{f as O}from"./format-CBpsKyOP.js";import{E as ve}from"./ellipsis-DTW6AACL.js";import{P as We}from"./plus-CgI7Ta1y.js";import"./dialog-V-TE0CwV.js";import"./x-BgpYH4Yb.js";import"./house-BsMbUd4i.js";import"./table-CXQMyFfb.js";import"./sliders-horizontal-cnWW7Bce.js";import"./arrow-left-D8MtdBnI.js";import"./arrow-right-iy4TempS.js";import"./card-TUnhNMrf.js";import"./globe-CvmVd3kB.js";const h=J.WALLET_MANAGEMENT;class z{static async getWallets(a){return u.get(h.BASE,{params:a})}static async getWalletByWalletID(a){return u.get(`${h.DETAIL_BY_ID(a)}`)}static async getWalletByWalletNumber(a){return u.get(`${h.DETAIL_BY_WALLET_NUMBER(a)}`)}static async getWalletByUser(a){return u.get(`${h.DETAIL_BY_USER(a)}`)}static async createWallet(a){return u.post(h.CREATE,a)}static async updateWallet(a,l){return u.put(`${h}/${a}`,l)}static async deleteWallet(a){return u.delete(`${h}/${a}`)}}const N={all:["wallets"],detail:t=>[...N.all,"detail",t],lists:()=>[...N.all,"list"],list:t=>[...N.lists(),t]},Ae=t=>he({queryKey:N.list({}),queryFn:()=>z.getWallets(t)}),Ie=()=>{const t=Q();return ue({mutationFn:a=>z.createWallet(a),onSuccess:()=>{t.invalidateQueries({queryKey:N.all})}})},De=xe({wallet_type:pe(["REVENUE","EXPENSE"],{required_error:"Please select a wallet type"})});function Te({onSubmit:t,loading:a=!1}){const l=R({resolver:$(De),defaultValues:{wallet_type:"REVENUE"}}),p=c=>{t(c),l.reset()};return e.jsx(K,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(p),className:"space-y-6",children:[e.jsx(_,{control:l.control,name:"wallet_type",render:({field:c})=>e.jsxs(U,{children:[e.jsx(me,{className:"text-gray-700",children:"Wallet Type"}),e.jsxs(k,{onValueChange:c.onChange,defaultValue:c.value,disabled:a,children:[e.jsx(C,{children:e.jsx(H,{className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",children:e.jsx(q,{placeholder:"Select wallet type"})})}),e.jsxs(G,{children:[e.jsx(b,{value:"REVENUE",children:"Revenue"}),e.jsx(b,{value:"EXPENSE",children:"Expense"})]})]}),e.jsx(V,{className:"text-red-500"})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(y,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:a,children:a?"Creating...":"Create Wallet"})})]})})}const _e=[{id:"user123",name:"John Doe"},{id:"user456",name:"Jane Smith"},{id:"user789",name:"Robert Johnson"},{id:"user101",name:"Emily Davis"},{id:"user102",name:"Michael Wilson"}],Ue=D.object({searchType:D.enum(["walletNumber","walletId","userId"]),searchValue:D.string().min(1,"Search value is required")});function Ve({wallets:t,loading:a=!1}){const[l,p]=x.useState([]),[c,o]=x.useState(null),[j,f]=x.useState(!1),[n,v]=x.useState(null),i=R({resolver:$(Ue),defaultValues:{searchType:"walletNumber",searchValue:""}}),E=i.watch("searchType"),W=s=>{let m=[...t];s.searchType==="walletNumber"?m=m.filter(g=>g.WalletNumber.toLowerCase().includes(s.searchValue.toLowerCase())):s.searchType==="walletId"?m=m.filter(g=>g.walletID.toLowerCase().includes(s.searchValue.toLowerCase())):s.searchType==="userId"&&n&&(m=m.filter(g=>{var F;return((F=g.User_ID)==null?void 0:F.toString())===n.id})),p(m),m.length===1?o(m[0]):o(null)},A=s=>O(new Date(s),"MMM dd, yyyy"),r=s=>{switch(s){case 1:return e.jsx(w,{className:"bg-green-500",children:"Active"});case 0:return e.jsx(w,{className:"bg-red-500",children:"Inactive"});default:return e.jsx(w,{className:"bg-gray-500",children:"Unknown"})}},d=s=>{switch(s){case"REVENUE":return e.jsx(S,{className:"h-4 w-4 text-[#4A36EC]"});case"EXPENSE":return e.jsx(M,{className:"h-4 w-4 text-[#4A36EC]"});default:return e.jsx(S,{className:"h-4 w-4 text-[#4A36EC]"})}},X=()=>E==="userId"?e.jsxs(ye,{open:j,onOpenChange:f,children:[e.jsx(je,{asChild:!0,children:e.jsx(C,{children:e.jsxs(y,{variant:"outline",role:"combobox","aria-expanded":j,className:"w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,children:[n?n.name:"Select user...",e.jsx(Se,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(ge,{className:"w-full p-0",children:e.jsxs(be,{children:[e.jsx(Ne,{placeholder:"Search users..."}),e.jsx(fe,{children:"No user found."}),e.jsx(Ee,{children:_e.map(s=>e.jsxs(we,{value:s.name,onSelect:()=>{v(s),f(!1),i.setValue("searchValue",s.id)},children:[e.jsx(Y,{className:T("mr-2 h-4 w-4",(n==null?void 0:n.id)===s.id?"opacity-100":"opacity-0")}),s.name]},s.id))})]})})]}):e.jsx(C,{children:e.jsx(Ce,{placeholder:E==="walletNumber"?"Enter wallet number (e.g., S000005)":"Enter wallet ID",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...i.register("searchValue")})});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{...i,children:e.jsx("form",{onSubmit:i.handleSubmit(W),className:"space-y-4",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{control:i.control,name:"searchType",render:()=>e.jsxs(U,{className:"w-[180px]",children:[e.jsxs(k,{onValueChange:s=>i.setValue("searchType",s),defaultValue:i.getValues("searchType"),disabled:a,children:[e.jsx(C,{children:e.jsx(H,{className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",children:e.jsx(q,{placeholder:"Search by..."})})}),e.jsxs(G,{children:[e.jsx(b,{value:"walletNumber",children:"Wallet Number"}),e.jsx(b,{value:"walletId",children:"Wallet ID"}),e.jsx(b,{value:"userId",children:"User"})]})]}),e.jsx(V,{className:"text-red-500"})]})}),e.jsx(_,{control:i.control,name:"searchValue",render:()=>e.jsxs(U,{className:"flex-1",children:[X(),e.jsx(V,{className:"text-red-500"})]})}),e.jsxs(y,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:a,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),a?"Searching...":"Search"]})]})})}),l.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Found ",l.length," wallet",l.length!==1?"s":""]}),l.map(s=>e.jsxs("div",{className:`p-4 border rounded-lg transition-colors cursor-pointer ${(c==null?void 0:c.id)===s.id?"border-[#4A36EC] bg-[#4A36EC]/5":"border-gray-200 hover:border-[#4A36EC]"}`,onClick:()=>o(s),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d(s.wallet_type),e.jsx("h3",{className:"font-medium",children:s.WalletNumber}),e.jsx(w,{variant:"outline",className:"ml-2",children:s.wallet_type})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["ID: ",s.walletID]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"GHS"}).format(s.balance)}),r(s.status)]})]}),(c==null?void 0:c.id)===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"User ID"}),e.jsx("p",{className:"text-base",children:s.User_ID||"Not assigned"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Created"}),e.jsx("p",{className:"text-base",children:A(s.date_created)})]})]})]},s.id))]}),l.length===0&&i.getValues("searchValue")&&e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"No wallets found matching your search criteria."})})]})}function cs(){const[t,a]=x.useState(!1),l=Ie(),p=P(),c=P(),{data:o,isLoading:j,isError:f}=Ae(),n=x.useMemo(()=>(o==null?void 0:o.data)||[],[o==null?void 0:o.data]),v=async r=>{a(!0);try{await l.mutateAsync(r),B.success("Wallet created successfully"),p.close()}catch(d){console.error("Error creating wallet:",d),B.error("Failed to create wallet. Please try again.")}finally{a(!1)}},i=()=>{p.openForm({title:"Create New Wallet",size:"sm",showFooter:!1,children:e.jsx(Te,{onSubmit:v,loading:t})})},E=()=>{c.openForm({title:"Search Wallets",size:"md",showFooter:!1,children:e.jsx(Ve,{wallets:n,loading:!1})})},W=x.useMemo(()=>[{header:"Wallet Number",accessorKey:"WalletNumber"},{header:"Wallet Type",accessorKey:"wallet_type",cell:({row:r})=>e.jsx("span",{className:"capitalize text-gray-600",children:r.original.wallet_type.toLowerCase()})},{header:"Balance",accessorKey:"balance",cell:({row:r})=>e.jsx("span",{children:new Intl.NumberFormat("en-US",{style:"currency",currency:"GHS"}).format(r.original.balance)})},{header:"User ID",accessorKey:"User_ID",cell:({row:r})=>e.jsx("span",{className:"text-gray-600",children:r.original.User_ID||"Not assigned"})},{header:"Status",accessorKey:"status",cell:({row:r})=>{const d=r.original.status===1;return e.jsxs("span",{className:T("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",d?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:T("w-1.5 h-1.5 rounded-full mr-1.5",d?"bg-green-400":"bg-red-400")}),d?"Active":"Inactive"]})}},{header:"Created On",accessorKey:"date_created",cell:({row:r})=>e.jsx("span",{className:"text-gray-600",children:O(new Date(r.original.date_created),"yyyy/MM/dd HH:mm:a")})},{header:"Actions",id:"actions",accessorKey:"actions",cell:()=>e.jsx("div",{className:"flex justify-end",children:e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(y,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ve,{className:"h-4 w-4"})]})}),e.jsxs(se,{align:"end",children:[e.jsx(ae,{children:"Actions"}),e.jsx(I,{children:"View Details"}),e.jsx(I,{children:"Edit Wallet"}),e.jsx(re,{}),e.jsx(I,{className:"text-red-600",children:"Deactivate"})]})]})})}],[]),A=[{title:"Total Wallets",value:n.length,Icon:S,description:"Active wallets in system",trend:"+3.2%",trendUp:!0},{title:"Total Balance",value:new Intl.NumberFormat("en-US",{style:"currency",currency:"GHS"}).format(n.reduce((r,d)=>r+d.balance,0)),Icon:M,description:"Combined wallet balance",trend:"+5.4%",trendUp:!0},{title:"Revenue Wallets",value:n.filter(r=>r.wallet_type==="REVENUE").length,Icon:S,description:"Wallets for revenue",trend:"+2.1%",trendUp:!0},{title:"Expense Wallets",value:n.filter(r=>r.wallet_type==="EXPENSE").length,Icon:M,description:"Wallets for expenses",trend:"+1.8%",trendUp:!0}];return j?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(te,{})}):f?e.jsx("div",{children:"Error loading wallets"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(ne,{items:ce.threeTier("Finance","/finance","Wallets")}),e.jsx(ie,{title:"Wallets",description:"Manage user wallets and balances",actions:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{onClick:E,variant:"outline",className:"border-[#4A36EC] text-[#4A36EC] hover:bg-[#4A36EC] hover:text-white",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Search"]}),e.jsxs(y,{onClick:i,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Add Wallet"]})]})}),e.jsx(de,{cards:A}),e.jsx(le.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(oe,{columns:W,data:n,loading:j,placeholder:"Search wallets...",tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{cs as default};
