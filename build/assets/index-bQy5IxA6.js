import{k as M,X as w,r as h,j as e,a as u,g as C,h as F,E as D,C as T,l as k,m as K,R as N}from"./index-CG3cDFil.js";import{u as B,B as U,a as _,P as q}from"./pageHeader-DU7bLt5i.js";import{D as H}from"./index-DVvBrNmU.js";import{C as L}from"./card-grid-DHAopdjS.js";import{u as $,a as G,F as z,b as j,c as b,d as f,e as y,f as g}from"./form-_i_eYalU.js";import{u as Q}from"./useMutation-CVaQmNh4.js";import{S as R,s as V,u as W}from"./sparepartsQueries-yTTQwbRL.js";import{s as X,o as E,a as J,b as S,n as O}from"./index-Cksdco4c.js";import{P as Y,a as Z,b as ee,C as re,c as ae,d as se,e as te,f as oe,g as ne}from"./popover-P3KGh40z.js";import{I as A}from"./input-0St3XTHq.js";import{T as ie}from"./textarea-DGzpSrm1.js";import{C as ce}from"./chevrons-up-down-BKctIM13.js";import{T as le}from"./trash-2-X-Fq5KTG.js";import{P as I}from"./plus-CgI7Ta1y.js";import{C as de}from"./clipboard-list-BadqyVU_.js";import{P as me}from"./package-CRRokNi8.js";import{f as pe}from"./format-CBpsKyOP.js";import"./dialog-V-TE0CwV.js";import"./x-BgpYH4Yb.js";import"./house-BsMbUd4i.js";import"./table-CXQMyFfb.js";import"./sliders-horizontal-cnWW7Bce.js";import"./select-xgui-4X2.js";import"./arrow-left-D8MtdBnI.js";import"./arrow-right-iy4TempS.js";import"./card-TUnhNMrf.js";import"./globe-CvmVd3kB.js";import"./useQuery-Nb54E3uG.js";const ue=()=>{const m=M();return Q({mutationFn:a=>R.createSparePart(a),onSuccess:()=>{m.invalidateQueries({queryKey:V.all})}})},he=E({name:S().min(1,"Spare part name is required"),description:S().min(1,"Description is required"),price:O().min(0,"Price must be 0 or greater"),carModel_ID:S().min(1,"Car model ID is required")}),xe=E({spareParts:J(he).min(1,"Add at least one spare part")});function je({onSubmit:m,loading:a=!1}){const{data:l}=w(),p=h.useMemo(()=>(l==null?void 0:l.models)||[],[l]),o=h.useMemo(()=>p.map(n=>({id:n.CarModel_ID,name:n.name})),[p]),s=$({resolver:X(xe),defaultValues:{spareParts:[{name:"",description:"",price:0,carModel_ID:""}]}}),{fields:x,append:d,remove:v}=G({control:s.control,name:"spareParts"}),P=n=>{m(n.spareParts),s.reset()};return e.jsx(z,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(P),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:x.map((n,i)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(j,{control:s.control,name:`spareParts.${i}.name`,render:({field:r})=>e.jsxs(b,{children:[e.jsx(f,{className:"text-gray-700",children:"Part Name"}),e.jsx(y,{children:e.jsx(A,{placeholder:"Enter part name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...r})}),e.jsx(g,{className:"text-red-500"})]})}),e.jsx(j,{control:s.control,name:`spareParts.${i}.description`,render:({field:r})=>e.jsxs(b,{children:[e.jsx(f,{className:"text-gray-700",children:"Description"}),e.jsx(y,{children:e.jsx(ie,{placeholder:"Enter part description",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...r})}),e.jsx(g,{className:"text-red-500"})]})}),e.jsx(j,{control:s.control,name:`spareParts.${i}.price`,render:({field:r})=>e.jsxs(b,{children:[e.jsx(f,{className:"text-gray-700",children:"Price"}),e.jsx(y,{children:e.jsx(A,{type:"number",step:"0.01",placeholder:"Enter price",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...r,onChange:t=>r.onChange(parseFloat(t.target.value)||0)})}),e.jsx(g,{className:"text-red-500"})]})}),e.jsx(j,{control:s.control,name:`spareParts.${i}.carModel_ID`,render:({field:r})=>{var t;return e.jsxs(b,{children:[e.jsx(f,{className:"text-gray-700",children:"Car Model"}),e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(y,{children:e.jsxs(u,{variant:"outline",role:"combobox",className:C("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!r.value&&"text-muted-foreground"),disabled:a,children:[r.value?(t=o.find(c=>c.id===r.value))==null?void 0:t.name:"Select car model...",e.jsx(ce,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(ee,{className:"w-full p-0",children:e.jsxs(re,{children:[e.jsx(ae,{placeholder:"Search car model..."}),e.jsxs(se,{children:[e.jsx(te,{children:"No car model found."}),e.jsx(oe,{children:o.map(c=>e.jsxs(ne,{value:c.name,onSelect:()=>{r.onChange(c.id)},children:[e.jsx(F,{className:C("mr-2 h-4 w-4",c.id===r.value?"opacity-100":"opacity-0")}),c.name]},c.id))})]})]})})]}),e.jsx(g,{className:"text-red-500"})]})}})]}),x.length>1&&e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>v(i),disabled:a,children:e.jsx(le,{className:"w-4 h-4 text-gray-600"})})]},n.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(u,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>d({name:"",description:"",price:0,carModel_ID:""}),disabled:a,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(u,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:a,children:a?"Saving...":"Save Spare Parts"})]})]})})}function Qe(){const[m,a]=h.useState(!1),l=ue(),p=B(),{data:o,isLoading:s,isError:x}=W(),d=h.useMemo(()=>(o==null?void 0:o.data)||[],[o==null?void 0:o.data]),v=async r=>{a(!0);try{await l.mutateAsync(r),N.success(`${r.length} spare part(s) created successfully`),p.close()}catch(t){console.error("Error creating spare parts:",t),N.error("Failed to create spare parts. Please try again.")}finally{a(!1)}},P=()=>{p.openForm({title:"Add Spare Parts",size:"md",showFooter:!1,children:e.jsx(je,{onSubmit:v,loading:m})})},n=h.useMemo(()=>[{header:"Name of Part",accessorKey:"name"},{header:"Description",accessorKey:"description"},{header:"Status",accessorKey:"status",cell:({row:r})=>{const t=r.original.status===1;return e.jsxs("span",{className:C("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",t?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:C("w-1.5 h-1.5 rounded-full mr-1.5",t?"bg-green-400":"bg-red-400")}),t?"Active":"Inactive"]})}},{header:"Price",accessorKey:"price",cell:({row:r})=>e.jsx("div",{children:new Intl.NumberFormat("en-US",{style:"currency",currency:"GHS"}).format(r.original.price)})},{header:"Created At",accessorKey:"createdAt",cell:({row:r})=>e.jsx("div",{children:pe(new Date(r.original.createdAt),"yyyy/MM/dd HH:mm:a")})}],[]),i=[{title:"Total Parts",value:d.length,Icon:D,description:"Active spare parts in system",trend:"+4.3%",trendUp:!0},{title:"Car Models",value:new Set(d.map(r=>r.carModel_ID)).size,Icon:T,description:"Compatible car models",trend:"+2.7%",trendUp:!0},{title:"Categories",value:12,Icon:de,description:"Part categories",trend:"+1.5%",trendUp:!0},{title:"In Stock",value:d.length,Icon:me,description:"Available inventory",trend:"-0.8%",trendUp:!1}];return s?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(k,{})}):x?e.jsx("div",{children:"Error loading spare parts"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(U,{items:_.threeTier("Inventory","/inventory","Spare Parts")}),e.jsx(q,{title:"Spare Parts",description:"Manage spare parts and their specifications",actions:e.jsxs(u,{onClick:P,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Add Spare Part"]})}),e.jsx(L,{cards:i}),e.jsx(K.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(H,{columns:n,data:d,placeholder:"Search spare parts...",tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{Qe as default};
