import{c as T,f as _,r as x,g as L,h as K,j as e,F as H,i as v,k as C,l as S,n as P,I as q,o as N,Q as U,R as $,e as y,p as M,T as z,V as B,X as V,Y as G,Z as Q,_ as R,$ as J,a0 as W,H as X,J as Y,K as Z,L as O,N as ee,q as re,ay as ae,a as se,az as te,P as ne,s as oe,v as ie,w as ce,C as le,m as de,D as me,x as I}from"./index-BEfPUQd3.js";import{u as pe}from"./modal-helpers-u5ghZSiS.js";import{u as ue}from"./useMutation-CxnX3va-.js";import{S as he,s as xe,u as je}from"./sparepartsQueries-BEUYh3PF.js";import{s as ye}from"./zod-DPUoip6C.js";import{o as w,a as ge,s as A}from"./index-3Gi9B8Cu.js";import{T as be}from"./textarea-BpM5EgwI.js";import{u as fe}from"./categoryQueries-I5xNgTW2.js";import{u as ve}from"./modelsQueries-CAzdMLFP.js";import{C as Ce}from"./chevrons-up-down-BEyfiSas.js";import{T as Se}from"./trash-2-DQhLckhX.js";import{P as F}from"./plus-D6nxsE-o.js";import"./dialog-DfEuW_jS.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Ne=T("ClipboardList",Pe),Ae=()=>{const j=_();return ue({mutationFn:r=>he.createSparePart(r),onSuccess:()=>{j.invalidateQueries({queryKey:xe.all})}})},Me=w({name:A().min(1,"Spare part name is required"),description:A().min(1,"Description is required"),carModel_ID:A().min(1,"Car model ID is required"),category_ID:A().nullable()}),Ee=w({spareParts:ge(Me).min(1,"Add at least one spare part")});function Ie({onSubmit:j,loading:r=!1}){const{data:o,isLoading:g,isError:i}=ve(),{data:c,isLoading:E,isError:u}=fe(),h=x.useMemo(()=>{var n;return(n=c==null?void 0:c.data)==null?void 0:n.map(l=>({value:l.Category_ID,label:l.name}))},[c==null?void 0:c.data]);console.log("availableCategories",h);const b=x.useMemo(()=>(o==null?void 0:o.data)||[],[o==null?void 0:o.data]),f=x.useMemo(()=>b.map(n=>({id:n.CarModel_ID,name:n.name})),[b]),t=L({resolver:ye(Ee),defaultValues:{spareParts:[{name:"",description:"",carModel_ID:"",category_ID:null}]}}),{fields:a,append:m,remove:D}=K({control:t.control,name:"spareParts"}),k=n=>{j(n.spareParts),t.reset()};return g||E?e.jsx("div",{children:"Loading..."}):i||u?e.jsx("div",{children:"Error loading spare parts or categories"}):e.jsx(H,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(k),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:a.map((n,l)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(v,{control:t.control,name:`spareParts.${l}.name`,render:({field:s})=>e.jsxs(C,{children:[e.jsx(S,{className:"text-gray-700",children:"Part Name"}),e.jsx(P,{children:e.jsx(q,{placeholder:"Enter part name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:r,...s})}),e.jsx(N,{className:"text-red-500"})]})}),e.jsx(v,{control:t.control,name:`spareParts.${l}.description`,render:({field:s})=>e.jsxs(C,{children:[e.jsx(S,{className:"text-gray-700",children:"Description"}),e.jsx(P,{children:e.jsx(be,{placeholder:"Enter part description",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:r,...s})}),e.jsx(N,{className:"text-red-500"})]})}),e.jsx(v,{control:t.control,name:`spareParts.${l}.carModel_ID`,render:({field:s})=>{var d;return e.jsxs(C,{children:[e.jsx(S,{className:"text-gray-700",children:"Car Model"}),e.jsxs(U,{children:[e.jsx($,{asChild:!0,children:e.jsx(P,{children:e.jsxs(y,{variant:"outline",role:"combobox",className:M("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!s.value&&"text-muted-foreground"),disabled:r,children:[s.value?(d=f.find(p=>p.id===s.value))==null?void 0:d.name:"Select car model...",e.jsx(Ce,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(z,{className:"w-full p-0",children:e.jsxs(B,{children:[e.jsx(V,{placeholder:"Search car model..."}),e.jsxs(G,{children:[e.jsx(Q,{children:"No car model found."}),e.jsx(R,{children:f.map(p=>e.jsxs(J,{value:p.name,onSelect:()=>{s.onChange(p.id)},children:[e.jsx(W,{className:M("mr-2 h-4 w-4",p.id===s.value?"opacity-100":"opacity-0")}),p.name]},p.id))})]})]})})]}),e.jsx(N,{className:"text-red-500"})]})}}),e.jsx(v,{control:t.control,name:`spareParts.${l}.category_ID`,render:({field:s})=>e.jsxs(C,{children:[e.jsx(S,{className:"text-gray-700",children:"Category"}),e.jsx(P,{children:e.jsxs(X,{value:s.value??"",onValueChange:d=>s.onChange(d),disabled:r,children:[e.jsx(Y,{className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",children:e.jsx(Z,{placeholder:"Select a Category"})}),e.jsx(O,{children:h==null?void 0:h.map(d=>e.jsx(ee,{value:d.value,children:d.label},d.value))})]})}),e.jsx(N,{className:"text-red-500"})]})})]}),a.length>1&&e.jsx(y,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>D(l),disabled:r,children:e.jsx(Se,{className:"w-4 h-4 text-gray-600"})})]},n.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(y,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>m({name:"",description:"",price:0,carModel_ID:""}),disabled:r,children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(y,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:r,children:r?"Saving...":"Save Spare Parts"})]})]})})}function Be(){const[j,r]=x.useState(!1),o=Ae(),g=pe(),{data:i,isLoading:c,isError:E}=je(),u=x.useMemo(()=>(i==null?void 0:i.data)||[],[i==null?void 0:i.data]),h=async a=>{r(!0);try{await o.mutateAsync(a),I.success(`${a.length} spare part(s) created successfully`),g.close()}catch(m){console.error("Error creating spare parts:",m),I.error("Failed to create spare parts. Please try again.")}finally{r(!1)}},b=()=>{g.openForm({title:"Add Spare Parts",size:"md",showFooter:!1,children:e.jsx(Ie,{onSubmit:h,loading:j})})},f=x.useMemo(()=>[{header:"Name of Part",accessorKey:"name"},{header:"Description",accessorKey:"description"},{header:"Status",accessorKey:"status",cell:({row:a})=>{const m=a.original.status===1;return e.jsxs("span",{className:M("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",m?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:M("w-1.5 h-1.5 rounded-full mr-1.5",m?"bg-green-400":"bg-red-400")}),m?"Active":"Inactive"]})}},{header:"Price",accessorKey:"price",cell:({row:a})=>e.jsx("div",{children:new Intl.NumberFormat("en-US",{style:"currency",currency:"GHS"}).format(a.original.price)})},{header:"Created At",accessorKey:"createdAt",cell:({row:a})=>e.jsx("div",{children:re(new Date(a.original.createdAt),"yyyy/MM/dd HH:mm:a")})}],[]),t=[{title:"Total Parts",value:u.length,Icon:ae,description:"Active spare parts in system",trend:"+4.3%",trendUp:!0},{title:"Car Models",value:new Set(u.map(a=>a.carModel_ID)).size,Icon:se,description:"Compatible car models",trend:"+2.7%",trendUp:!0},{title:"Categories",value:12,Icon:Ne,description:"Part categories",trend:"+1.5%",trendUp:!0},{title:"In Stock",value:u.length,Icon:te,description:"Available inventory",trend:"-0.8%",trendUp:!1}];return c?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(ne,{})}):E?e.jsx("div",{children:"Error loading spare parts"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(oe,{items:ie.threeTier("Inventory","/inventory","Spare Parts")}),e.jsx(ce,{title:"Spare Parts",description:"Manage spare parts and their specifications",actions:e.jsxs(y,{onClick:b,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Add Spare Part"]})}),e.jsx(le,{cards:t}),e.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(me,{columns:f,data:u,placeholder:"Search spare parts...",tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{Be as default};
