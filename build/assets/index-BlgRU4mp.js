import{r as l,u as X,b as J,j as e,c as W,P as $,d as F,e as Y,f as Z,g as _,h as ee,A as y,i as se,k as te,t as re,a as I,S as ae,U as ne,l as ie,n as L,m as U}from"./index-CG3cDFil.js";import{D as oe}from"./index-DVvBrNmU.js";import{C as ce}from"./card-grid-DHAopdjS.js";import{u as le,a as de,F as me,b as k,c as P,d as E,e as S,f as w}from"./form-_i_eYalU.js";import{u as ue}from"./useMutation-CVaQmNh4.js";import{u as pe}from"./useQuery-Nb54E3uG.js";import{s as he,o as K,a as O,b as D}from"./index-Cksdco4c.js";import{u as xe,S as fe,a as ge,b as je,c as be,d as ye}from"./select-xgui-4X2.js";import{D as Ce,a as ve,b as Ne,c as ke,d as Pe}from"./dialog-V-TE0CwV.js";import{I as Ee}from"./input-0St3XTHq.js";import{T as Ae}from"./textarea-DGzpSrm1.js";import{T as Se}from"./trash-2-X-Fq5KTG.js";import{P as q}from"./plus-CgI7Ta1y.js";import{L as we}from"./lock-BGQdcYA5.js";import{F as De}from"./file-check-BkPECMnS.js";import{f as Ie}from"./format-CBpsKyOP.js";import"./table-CXQMyFfb.js";import"./sliders-horizontal-cnWW7Bce.js";import"./x-BgpYH4Yb.js";import"./arrow-left-D8MtdBnI.js";import"./arrow-right-iy4TempS.js";import"./card-TUnhNMrf.js";import"./popover-P3KGh40z.js";import"./globe-CvmVd3kB.js";var M="Checkbox",[Re,fs]=W(M),[Me,Te]=Re(M),B=l.forwardRef((s,t)=>{const{__scopeCheckbox:n,name:i,checked:o,defaultChecked:c,required:h,disabled:m,value:x="on",onCheckedChange:d,form:a,...r}=s,[u,g]=l.useState(null),j=X(t,p=>g(p)),v=l.useRef(!1),T=u?a||!!u.closest("form"):!0,[b=!1,R]=J({prop:o,defaultProp:c,onChange:d}),V=l.useRef(b);return l.useEffect(()=>{const p=u==null?void 0:u.form;if(p){const N=()=>R(V.current);return p.addEventListener("reset",N),()=>p.removeEventListener("reset",N)}},[u,R]),e.jsxs(Me,{scope:n,state:b,disabled:m,children:[e.jsx($.button,{type:"button",role:"checkbox","aria-checked":f(b)?"mixed":b,"aria-required":h,"data-state":H(b),"data-disabled":m?"":void 0,disabled:m,value:x,...r,ref:j,onKeyDown:F(s.onKeyDown,p=>{p.key==="Enter"&&p.preventDefault()}),onClick:F(s.onClick,p=>{R(N=>f(N)?!0:!N),T&&(v.current=p.isPropagationStopped(),v.current||p.stopPropagation())})}),T&&e.jsx(Fe,{control:u,bubbles:!v.current,name:i,value:x,checked:b,required:h,disabled:m,form:a,style:{transform:"translateX(-100%)"},defaultChecked:f(c)?!1:c})]})});B.displayName=M;var z="CheckboxIndicator",G=l.forwardRef((s,t)=>{const{__scopeCheckbox:n,forceMount:i,...o}=s,c=Te(z,n);return e.jsx(Y,{present:i||f(c.state)||c.state===!0,children:e.jsx($.span,{"data-state":H(c.state),"data-disabled":c.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...s.style}})})});G.displayName=z;var Fe=s=>{const{control:t,checked:n,bubbles:i=!0,defaultChecked:o,...c}=s,h=l.useRef(null),m=xe(n),x=Z(t);l.useEffect(()=>{const a=h.current,r=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(r,"checked").set;if(m!==n&&g){const j=new Event("click",{bubbles:i});a.indeterminate=f(n),g.call(a,f(n)?!1:n),a.dispatchEvent(j)}},[m,n,i]);const d=l.useRef(f(n)?!1:n);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o??d.current,...c,tabIndex:-1,ref:h,style:{...s.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function f(s){return s==="indeterminate"}function H(s){return f(s)?"indeterminate":s?"checked":"unchecked"}var Le=B,Ue=G;function $e({className:s,...t}){return e.jsx(Le,{"data-slot":"checkbox",className:_("peer border-input data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground data-[state=checked]:border-primary ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 size-4 shrink-0 rounded-[4px] border shadow-xs transition-[color,box-shadow] focus-visible:ring-4 focus-visible:outline-1 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:focus-visible:ring-0",s),...t,children:e.jsx(Ue,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current",children:e.jsx(ee,{className:"size-3.5"})})})}const C=se.ACCESS_MANAGEMENT.PERMISSION;class Q{static async getPermission(t){return y.get(`${C}/${t}`)}static async createPermission(t){return y.post(C.CREATE,t)}static async updatePermission(t,n){return y.put(C.UPDATE,n)}static async deletePermission(t){return y.delete(`${C}/${t}`)}static async getPermissionList(t){return y.get(C.BASE,{params:t})}static async getPermissionStats(t){return y.get(`${C}/${t}/stats`)}}const A={all:["permission"],list:()=>[...A.all,"list"],details:s=>[...A.all,"details",s],stats:s=>[...A.all,"stats",s]},_e=()=>pe({queryKey:A.list(),queryFn:()=>Q.getPermissionList()}),Ke=()=>{const s=te();return ue({mutationFn:t=>Q.createPermission(t),onSuccess:()=>{s.invalidateQueries({queryKey:A.all}),re.success("Permission created successfully")}})},Oe=K({name:D().min(1,"Permission name is required"),description:D().min(10,"Description must be at least 10 characters"),module:D().min(1,"Module is required"),actions:O(D()).min(1,"Select at least one action")}),qe=K({permissions:O(Oe).min(1,"Add at least one permission")}),Be=["create","read","update","delete","approve","reject"],ze=["inventory","sales","purchases","reports","users","settings"];function Ge({open:s,onOpenChange:t,onSubmit:n}){const i=le({resolver:he(qe),defaultValues:{permissions:[{name:"",description:"",module:"",actions:[]}]}}),{fields:o,append:c,remove:h}=de({control:i.control,name:"permissions"}),m=x=>{n(x.permissions),i.reset()};return e.jsx(Ce,{open:s,onOpenChange:t,children:e.jsxs(ve,{className:"max-w-2xl bg-white",children:[e.jsxs(Ne,{children:[e.jsx(ke,{className:"text-[#4A36EC] text-xl font-bold",children:"Add Permissions"}),e.jsx(Pe,{className:"text-gray-600",children:"Define new permissions and their access levels"})]}),e.jsx(me,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(m),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:o.map((x,d)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(k,{control:i.control,name:`permissions.${d}.name`,render:({field:a})=>e.jsxs(P,{children:[e.jsx(E,{className:"text-gray-700",children:"Permission Name"}),e.jsx(S,{children:e.jsx(Ee,{placeholder:"Enter permission name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...a})}),e.jsx(w,{className:"text-red-500"})]})}),e.jsx(k,{control:i.control,name:`permissions.${d}.description`,render:({field:a})=>e.jsxs(P,{children:[e.jsx(E,{className:"text-gray-700",children:"Description"}),e.jsx(S,{children:e.jsx(Ae,{placeholder:"Enter permission description",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...a})}),e.jsx(w,{className:"text-red-500"})]})}),e.jsx(k,{control:i.control,name:`permissions.${d}.module`,render:({field:a})=>e.jsxs(P,{children:[e.jsx(E,{className:"text-gray-700",children:"Module"}),e.jsxs(fe,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(S,{children:e.jsx(ge,{className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",children:e.jsx(je,{placeholder:"Select module"})})}),e.jsx(be,{children:ze.map(r=>e.jsx(ye,{value:r,children:r.charAt(0).toUpperCase()+r.slice(1)},r))})]}),e.jsx(w,{className:"text-red-500"})]})}),e.jsx(k,{control:i.control,name:`permissions.${d}.actions`,render:()=>e.jsxs(P,{children:[e.jsx(E,{className:"text-gray-700",children:"Actions"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:Be.map(a=>e.jsx(k,{control:i.control,name:`permissions.${d}.actions`,render:({field:r})=>{var u;return e.jsxs(P,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(S,{children:e.jsx($e,{checked:(u=r.value)==null?void 0:u.includes(a),onCheckedChange:g=>{var j;return g?r.onChange([...r.value,a]):r.onChange((j=r.value)==null?void 0:j.filter(v=>v!==a))}})}),e.jsx(E,{className:"text-sm font-normal",children:a.charAt(0).toUpperCase()+a.slice(1)})]},a)}},a))}),e.jsx(w,{className:"text-red-500"})]})})]}),o.length>1&&e.jsx(I,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>h(d),children:e.jsx(Se,{className:"w-4 h-4 text-gray-600"})})]},x.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(I,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>c({name:"",description:"",module:"",actions:[]}),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(I,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:"Save Permissions"})]})]})})]})})}function gs(){const[s,t]=l.useState(!1),[n,i]=l.useState([]),{data:o,isError:c,isLoading:h}=_e();l.useEffect(()=>(o&&i(o.data),()=>{i([])}),[o==null?void 0:o.data]);const m=l.useMemo(()=>[{header:"Permission Name",accessorKey:"title"},{header:"Description",accessorKey:"description"},{header:"Status",accessorKey:"status",cell:({row:r})=>e.jsx("span",{className:_(r.original.status===1?"text-green-900 bg-green-100":"text-red-900 bg-red-100","text-sm px-2 py-1 rounded-md"),children:r.original.status===1?"Active":"Inactive"})},{header:"Created On",accessorKey:"date_added",cell:({row:r})=>e.jsx("span",{children:Ie(new Date(r.original.date_added),"dd/MM/yyyy")})}],[]),{mutate:x}=Ke(),d=async r=>{console.log(r),i([...n,...r]),t(!1)},a=[{title:"Total Permissions",value:n.length,Icon:ae,description:"Active permissions in system",trend:"+2.5%",trendUp:!0},{title:"User Groups",value:8,Icon:ne,description:"Groups with permissions",trend:"+1.2%",trendUp:!0},{title:"Access Levels",value:new Set(n.map(r=>r.permissionID)).size,Icon:we,description:"Different access levels",trend:"+3.4%",trendUp:!0},{title:"Modules",value:12,Icon:De,description:"Protected modules",trend:"+1.8%",trendUp:!0}];return h?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(ie,{})}):c?e.jsx("div",{children:"Error loading permissions"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx("a",{href:"/",className:"hover:text-[#4A36EC]",children:"Dashboard"}),e.jsx(L,{className:"w-4 h-4 mx-2"}),e.jsx("a",{href:"/access-control",className:"hover:text-[#4A36EC]",children:"Access Control"}),e.jsx(L,{className:"w-4 h-4 mx-2"}),e.jsx("span",{className:"text-[#4A36EC] font-medium",children:"Permissions"})]}),e.jsxs(U.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#4A36EC]",children:"Permissions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage system permissions and access controls"})]}),e.jsxs(I,{onClick:()=>t(!0),className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Add Permission"]})]}),e.jsx(ce,{cards:a}),e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(oe,{data:n,columns:m,loading:h,tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})}),e.jsx(Ge,{open:s,onOpenChange:t,onSubmit:d})]})}export{gs as default};
