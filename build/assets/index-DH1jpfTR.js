import{Z as G,k as Z,X as Q,r as x,j as e,a as g,g as p,h as D,Y as J,C as W,F as ee,x as ae,l as se,m as re,R as P}from"./index-CG3cDFil.js";import{u as te,B as ne,a as oe,P as le}from"./pageHeader-DU7bLt5i.js";import{D as ce}from"./index-DVvBrNmU.js";import{C as ie}from"./card-grid-DHAopdjS.js";import{u as de,a as me,F as ue,b as w,c as S,d as I,e as A,f as F}from"./form-_i_eYalU.js";import{u as xe}from"./useMutation-CVaQmNh4.js";import{u as he}from"./useQuery-Nb54E3uG.js";import{s as pe,o as R,a as fe,n as ge,b as Y}from"./index-Cksdco4c.js";import{P as T,a as _,b as L,C as K,c as U,d as q,e as O,f as $,g as z}from"./popover-P3KGh40z.js";import{I as je}from"./input-0St3XTHq.js";import{C as be}from"./chevrons-up-down-BKctIM13.js";import{C as V}from"./calendar-CHicwQ2t.js";import{T as ye}from"./trash-2-X-Fq5KTG.js";import{P as H}from"./plus-CgI7Ta1y.js";import"./dialog-V-TE0CwV.js";import"./x-BgpYH4Yb.js";import"./house-BsMbUd4i.js";import"./table-CXQMyFfb.js";import"./sliders-horizontal-cnWW7Bce.js";import"./select-xgui-4X2.js";import"./arrow-left-D8MtdBnI.js";import"./arrow-right-iy4TempS.js";import"./card-TUnhNMrf.js";import"./globe-CvmVd3kB.js";const j={all:["models"],detail:o=>[...j.all,"detail",o],lists:()=>[...j.all,"list"],list:o=>[...j.lists(),o],stats:()=>[...j.all,"stats"]},Me=o=>he({queryKey:j.list({}),queryFn:()=>G.getCarModels(o)}),Ce=()=>{const o=Z();return xe({mutationFn:n=>G.createCarModel(n),onSuccess:()=>{o.invalidateQueries({queryKey:j.all})}})},Ne=R({name:Y().min(1,"Model name is required"),carBrand_ID:Y().min(1,"Car brand ID is required"),yearOfMake:ge().min(1900,"Year must be 1900 or later").max(new Date().getFullYear()+1,"Year cannot be in the future")}),ve=R({models:fe(Ne).min(1,"Add at least one model")});function we({onSubmit:o,loading:n=!1}){const{data:f}=Q(),b=x.useMemo(()=>(f==null?void 0:f.brands)||[],[f]),d=x.useMemo(()=>b.map(l=>({id:l.CarBrand_ID,name:l.name})),[b]),M=x.useMemo(()=>{const l=new Date().getFullYear(),c=[];for(let a=l+1;a>=1900;a--)c.push(a);return c},[]),m=de({resolver:pe(ve),defaultValues:{models:[{name:"",carBrand_ID:"",yearOfMake:new Date().getFullYear()}]}}),{fields:h,append:C,remove:N}=me({control:m.control,name:"models"}),r=l=>{o(l.models),m.reset()};return e.jsx(ue,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(r),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:h.map((l,c)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(w,{control:m.control,name:`models.${c}.name`,render:({field:a})=>e.jsxs(S,{children:[e.jsx(I,{className:"text-gray-700",children:"Model Name"}),e.jsx(A,{children:e.jsx(je,{placeholder:"Enter model name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:n,...a})}),e.jsx(F,{className:"text-red-500"})]})}),e.jsx(w,{control:m.control,name:`models.${c}.carBrand_ID`,render:({field:a})=>{var i;return e.jsxs(S,{children:[e.jsx(I,{className:"text-gray-700",children:"Car Brand"}),e.jsxs(T,{children:[e.jsx(_,{asChild:!0,children:e.jsx(A,{children:e.jsxs(g,{variant:"outline",role:"combobox",className:p("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!a.value&&"text-muted-foreground"),disabled:n,children:[a.value?(i=d.find(u=>u.id===a.value))==null?void 0:i.name:"Select car brand...",e.jsx(be,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(L,{className:"w-full p-0",children:e.jsxs(K,{children:[e.jsx(U,{placeholder:"Search car brand..."}),e.jsxs(q,{children:[e.jsx(O,{children:"No car brand found."}),e.jsx($,{children:d.map(u=>e.jsxs(z,{value:u.name,onSelect:()=>{a.onChange(u.id)},children:[e.jsx(D,{className:p("mr-2 h-4 w-4",u.id===a.value?"opacity-100":"opacity-0")}),u.name]},u.id))})]})]})})]}),e.jsx(F,{className:"text-red-500"})]})}}),e.jsx(w,{control:m.control,name:`models.${c}.yearOfMake`,render:({field:a})=>e.jsxs(S,{children:[e.jsx(I,{className:"text-gray-700",children:"Year of Make"}),e.jsxs(T,{children:[e.jsx(_,{asChild:!0,children:e.jsx(A,{children:e.jsxs(g,{variant:"outline",role:"combobox",className:p("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!a.value&&"text-muted-foreground"),disabled:n,children:[a.value?a.value.toString():"Select year...",e.jsx(V,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(L,{className:"w-full p-0",children:e.jsxs(K,{children:[e.jsx(U,{placeholder:"Search year..."}),e.jsxs(q,{children:[e.jsx(O,{children:"No year found."}),e.jsx($,{children:M.map(i=>e.jsxs(z,{value:i.toString(),onSelect:()=>{a.onChange(i)},children:[e.jsx(D,{className:p("mr-2 h-4 w-4",i===a.value?"opacity-100":"opacity-0")}),i]},i))})]})]})})]}),e.jsx(F,{className:"text-red-500"})]})})]}),h.length>1&&e.jsx(g,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>N(c),disabled:n,children:e.jsx(ye,{className:"w-4 h-4 text-gray-600"})})]},l.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(g,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>C({name:"",carBrand_ID:"",yearOfMake:new Date().getFullYear()}),disabled:n,children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(g,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:n,children:n?"Saving...":"Save Models"})]})]})})}function Xe(){const[o,n]=x.useState(!1),f=Ce(),b=te(),{data:d,isLoading:M,isError:m}=Me(),h=x.useMemo(()=>(d==null?void 0:d.data)||[],[d==null?void 0:d.data]),C=async s=>{n(!0);try{await f.mutateAsync(s),P.success(`${s.length} model(s) created successfully`),b.close()}catch(t){console.error("Error creating models:",t),P.error("Failed to create models. Please try again.")}finally{n(!1)}},N=()=>{b.openForm({title:"Add Vehicle Models",size:"md",showFooter:!1,children:e.jsx(we,{onSubmit:C,loading:o})})},{data:r,isLoading:l}=Q();x.useEffect(()=>{const s=J.getState().actions.loadInventoryData;s()},[]);const c=x.useMemo(()=>r!=null&&r.manufacturers?new Map(r.manufacturers.map(s=>[s.Manufacturer_ID,s])):new Map,[r==null?void 0:r.manufacturers]),a=x.useCallback(s=>{const t=c.get(s);return(t==null?void 0:t.name)||s||"Unknown"},[c]),i=x.useMemo(()=>[{header:"Name of Model",accessorKey:"name"},{header:"Manufacturer",accessorKey:"carBrand.manufacturer_ID",cell:({row:s})=>{var E,k;const t=(E=s.original.carBrand)==null?void 0:E.manufacturer_ID,y=a(t||""),X=l&&!(r!=null&&r.manufacturers),v=y===t;return console.log("Debug Models Manufacturer:",{modelName:s.original.name,carBrand:s.original.carBrand,manufacturerId:t,manufacturerName:y,availableManufacturers:((k=r==null?void 0:r.manufacturers)==null?void 0:k.map(B=>({id:B.Manufacturer_ID,name:B.name})))||[],lookupResult:c.get(t||"")}),X?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}):t?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:p("font-medium",v?"text-amber-600":"text-gray-900"),title:v?`ID: ${t}`:y,children:y}),v&&e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",t]})]}):e.jsx("span",{className:"text-gray-400",children:"No manufacturer"})}},{header:"Status",accessorKey:"status",cell:({row:s})=>{const t=s.original.status===1;return e.jsxs("span",{className:p("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",t?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:p("w-1.5 h-1.5 rounded-full mr-1.5",t?"bg-green-400":"bg-red-400")}),t?"Active":"Inactive"]})}},{header:"Year of Make",accessorKey:"yearOfMake"}],[a,r==null?void 0:r.manufacturers,l]),u=[{title:"Total Models",value:h.length,Icon:W,description:"Active car models in the system",trend:"+3.2%",trendUp:!0},{title:"Latest Year",value:h.length>0?Math.max(...h.map(s=>s.yearOfMake)):0,Icon:V,description:"Most recent model year",trend:"+1.5%",trendUp:!0},{title:"Manufacturers",value:new Set(h.map(s=>s.carBrand_ID)).size,Icon:ee,description:"Associated manufacturers",trend:"+2.8%",trendUp:!0},{title:"Parts Categories",value:89,Icon:ae,description:"Compatible parts categories",trend:"+4.1%",trendUp:!0}];return M?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(se,{})}):m?e.jsx("div",{children:"Error loading models"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(ne,{items:oe.threeTier("Inventory","/inventory","Models")}),e.jsx(le,{title:"Vehicle Models",description:"Manage vehicle models and their specifications",actions:e.jsxs(g,{onClick:N,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Add Model"]})}),e.jsx(ie,{cards:u}),e.jsx(re.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(ce,{columns:i,data:h,placeholder:"Search models...",tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{Xe as default};
