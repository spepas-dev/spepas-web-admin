import{c as z,E as V,av as D,f as O,aw as P,r as u,g as $,h as H,j as e,F as Q,i as I,k as M,l as S,n as w,I as G,o as E,Q as Y,R as J,e as b,p as y,T as W,V as X,X as Z,Y as ee,Z as ae,_ as se,$ as re,a0 as ne,H as te,J as ce,K as le,L as oe,N as T,q as de,u as ie,at as ue,a as me,P as xe,s as he,v as pe,w as fe,C as ge,m as be,D as ye,x as L}from"./index-BEfPUQd3.js";import{u as je}from"./modal-helpers-u5ghZSiS.js";import{u as ve}from"./useMutation-CxnX3va-.js";import{s as Ce}from"./zod-DPUoip6C.js";import{o as R,a as Ne,e as Be,s as _}from"./index-3Gi9B8Cu.js";import{C as Ae}from"./chevrons-up-down-BEyfiSas.js";import{T as Ie}from"./trash-2-DQhLckhX.js";import{P as K}from"./plus-D6nxsE-o.js";import{B as Me}from"./building-2-CTShFezU.js";import"./dialog-DfEuW_jS.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]],we=z("Tags",Se),h={all:["brands"],detail:a=>[...h.all,"detail",a],lists:()=>[...h.all,"list"],list:a=>[...h.lists(),a],byType:a=>[...h.all,"type",a],stats:()=>[...h.all,"stats"]},Ee=a=>V({queryKey:h.list({}),queryFn:()=>D.getBrands(a)}),Te=()=>{const a=O();return ve({mutationFn:n=>D.createBrand({...n,isActive:!1}),onSuccess:()=>{a.invalidateQueries({queryKey:h.all})}})},Fe=R({name:_().min(1,"Brand name is required"),manufacturer_ID:_().min(1,"Manufacturer ID is required"),type:Be(["CAR","TRUCK","MOTORCYCLE"],{required_error:"Brand type is required"})}),ke=R({brands:Ne(Fe).min(1,"Add at least one brand")});function Le({onSubmit:a,loading:n=!1}){const{data:p}=P(),g=u.useMemo(()=>(p==null?void 0:p.manufacturers)||[],[p]),j=u.useMemo(()=>g.map(t=>({id:t.Manufacturer_ID,name:t.name})),[g]),l=$({resolver:Ce(ke),defaultValues:{brands:[{name:"",manufacturer_ID:"",type:"CAR"}]}}),{fields:d,append:v,remove:B}=H({control:l.control,name:"brands"}),m=t=>{a(t.brands),l.reset()};return e.jsx(Q,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(m),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:d.map((t,x)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(I,{control:l.control,name:`brands.${x}.name`,render:({field:c})=>e.jsxs(M,{children:[e.jsx(S,{className:"text-gray-700",children:"Brand Name"}),e.jsx(w,{children:e.jsx(G,{placeholder:"Enter brand name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:n,...c})}),e.jsx(E,{className:"text-red-500"})]})}),e.jsx(I,{control:l.control,name:`brands.${x}.manufacturer_ID`,render:({field:c})=>{var C;return e.jsxs(M,{children:[e.jsx(S,{className:"text-gray-700",children:"Manufacturer"}),e.jsxs(Y,{children:[e.jsx(J,{asChild:!0,children:e.jsx(w,{children:e.jsxs(b,{variant:"outline",role:"combobox",className:y("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!c.value&&"text-muted-foreground"),disabled:n,children:[c.value?(C=j.find(i=>i.id===c.value))==null?void 0:C.name:"Select manufacturer...",e.jsx(Ae,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(W,{className:"w-full p-0",children:e.jsxs(X,{children:[e.jsx(Z,{placeholder:"Search manufacturer..."}),e.jsxs(ee,{children:[e.jsx(ae,{children:"No manufacturer found."}),e.jsx(se,{children:j.map(i=>e.jsxs(re,{value:i.name,onSelect:()=>{c.onChange(i.id)},children:[e.jsx(ne,{className:y("mr-2 h-4 w-4",i.id===c.value?"opacity-100":"opacity-0")}),i.name]},i.id))})]})]})})]}),e.jsx(E,{className:"text-red-500"})]})}}),e.jsx(I,{control:l.control,name:`brands.${x}.type`,render:({field:c})=>e.jsxs(M,{children:[e.jsx(S,{className:"text-gray-700",children:"Brand Type"}),e.jsxs(te,{onValueChange:c.onChange,defaultValue:c.value,disabled:n,children:[e.jsx(w,{children:e.jsx(ce,{className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",children:e.jsx(le,{placeholder:"Select brand type"})})}),e.jsxs(oe,{children:[e.jsx(T,{value:"CAR",children:"Car"}),e.jsx(T,{value:"TRUCK",children:"Truck"}),e.jsx(T,{value:"MOTORCYCLE",children:"Motorcycle"})]})]}),e.jsx(E,{className:"text-red-500"})]})})]}),d.length>1&&e.jsx(b,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>B(x),disabled:n,children:e.jsx(Ie,{className:"w-4 h-4 text-gray-600"})})]},t.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(b,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>v({name:"",manufacturer_ID:"",type:"CAR"}),disabled:n,children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(b,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:n,children:n?"Saving...":"Save Brands"})]})]})})}function $e(){const{data:a,isLoading:n}=P(),[p,g]=u.useState(!1),j=Te(),l=je(),{data:d,isLoading:v,isError:B}=Ee(),m=u.useMemo(()=>(d==null?void 0:d.data)||[],[d==null?void 0:d.data]),t=u.useMemo(()=>a!=null&&a.manufacturers?new Map(a.manufacturers.map(s=>[s.Manufacturer_ID,s])):new Map,[a==null?void 0:a.manufacturers]),x=u.useCallback(s=>{const r=t.get(s);return(r==null?void 0:r.name)||s||"Unknown"},[t]),c=async s=>{g(!0);try{await j.mutateAsync(s),L.success(`${s.length} brand(s) created successfully`),l.close()}catch(r){console.error("Error creating brands:",r),L.error("Failed to create brands. Please try again.")}finally{g(!1)}},C=()=>{l.openForm({title:"Add Vehicle Brands",size:"md",showFooter:!1,children:e.jsx(Le,{onSubmit:c,loading:p})})},i=u.useMemo(()=>[{header:"Brand Name",accessorKey:"name",cell:({row:s})=>e.jsx("span",{className:"font-medium",children:s.original.name})},{header:"Brand Type",accessorKey:"type",cell:({row:s})=>e.jsx("span",{className:"capitalize text-gray-600",children:s.original.type.toLowerCase()})},{header:"Manufacturer",accessorKey:"manufacturer_ID",cell:({row:s})=>{var F;const r=s.original,o=r.manufacturer_ID,f=r.manufacturer,N=x(o),U=n&&!(a!=null&&a.manufacturers),A=N===o;return console.log("Debug Brand Manufacturer:",{brandName:s.original.name,manufacturerId:o,nestedManufacturer:f,fullBrandObject:s.original,manufacturerName:N,availableManufacturers:((F=a==null?void 0:a.manufacturers)==null?void 0:F.map(k=>({id:k.Manufacturer_ID,name:k.name})))||[],lookupResult:t.get(o),manufacturerLookupSize:t.size}),U?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}):f!=null&&f.name?e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"font-medium text-gray-900",title:f.name,children:f.name})}):o?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:y("font-medium",A?"text-amber-600":"text-gray-900"),title:A?`ID: ${o}`:N,children:N}),A&&e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",o]})]}):e.jsx("span",{className:"text-gray-400",children:"No manufacturer ID"})}},{header:"Status",accessorKey:"status",cell:({row:s})=>{const r=s.original.status===1;return e.jsxs("span",{className:y("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:y("w-1.5 h-1.5 rounded-full mr-1.5",r?"bg-green-400":"bg-red-400")}),r?"Active":"Inactive"]})}},{header:"Added On",accessorKey:"createdAt",cell:({row:s})=>{try{const r=new Date(s.original.createdAt);return e.jsx("span",{className:"text-gray-600",children:de(r,"dd/MM/yyyy")})}catch{return e.jsx("span",{className:"text-gray-400",children:"Invalid date"})}}}],[x,n,a==null?void 0:a.manufacturers,t]);u.useEffect(()=>{const s=ie.getState().actions.loadInventoryData;s()},[]),u.useEffect(()=>{var s,r,o;a&&console.log("Inventory data loaded:",{manufacturers:((s=a.manufacturers)==null?void 0:s.length)||0,brands:((r=a.brands)==null?void 0:r.length)||0,models:((o=a.models)==null?void 0:o.length)||0})},[a]);const q=[{title:"Total Brands",value:m.length,Icon:Me,description:"Active brands in the system",trend:"+2.1%",trendUp:!0},{title:"Manufacturers",value:new Set(m.map(s=>s.manufacturer_ID)).size,Icon:ue,description:"Associated manufacturers",trend:"+1.8%",trendUp:!0},{title:"Car Brands",value:m.filter(s=>s.type==="CAR").length,Icon:me,description:"Passenger vehicle brands",trend:"+3.4%",trendUp:!0},{title:"Brand Types",value:new Set(m.map(s=>s.type)).size,Icon:we,description:"Different brand categories",trend:"+1.2%",trendUp:!0}];return v?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(xe,{})}):B?e.jsx("div",{children:"Error loading brands"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(he,{items:pe.threeTier("Inventory","/inventory","Brands")}),e.jsx(fe,{title:"Vehicle Brands",description:"Manage vehicle brands and their associations",actions:e.jsxs(b,{onClick:C,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Brand"]})}),e.jsx(ge,{cards:q}),e.jsx(be.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(ye,{data:m,columns:i,loading:v,tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{$e as default};
