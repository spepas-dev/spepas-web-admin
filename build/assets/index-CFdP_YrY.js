import{z as l,y as L,E as S,r as d,j as e,p as j,q as N,aV as B,U as M,s as A,v as E,w as I,C as U,m as v,D,x as P}from"./index-BEfPUQd3.js";import{u as $}from"./modal-helpers-u5ghZSiS.js";import{u as C,G,M as K,I as k,a as F}from"./esm-Dq51DQsy.js";import{z as o}from"./index-3Gi9B8Cu.js";import"./multi-select-DEp3z63F.js";import{S as _}from"./shopping-bag-njn_Y5Y-.js";import"./dialog-DfEuW_jS.js";import"./separator-DpEqoi9c.js";import"./circle-x-Bb9PP882.js";const c=L.USER_MANAGEMENT.BUYER;class w{static async registerBuyer(s){return l.post(`${c}`,s)}static async getBuyer(s){return l.get(`${c}/${s}`)}static async updateBuyer(s,r){return l.put(`${c}/${s}`,r)}static async deleteBuyer(s){return l.delete(`${c}/${s}`)}static async getBuyerStats(s){return l.get(`${c}/${s}/stats`)}static async getBuyerList(s){return l.get(`${c.BASE}`,{params:s})}}const p={all:["buyers"],list:()=>[...p.all,"list"],details:a=>[...p.all,"details",a],stats:a=>[...p.all,"stats",a]},T=()=>S({queryKey:p.list(),queryFn:()=>w.getBuyerList()}),R=["places"];function z({buyers:a,selectedLocation:s,onLocationSelect:r}){var m,g;const{isLoaded:y,loadError:x}=C({googleMapsApiKey:"AIzaSyDLsZ984L00maH7hl__gWQ-v7U-KWOEnfU",libraries:R}),[n,u]=d.useState(null),h=d.useMemo(()=>s||{lat:5.6037,lng:-.187},[s]);return x?e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"text-red-600",children:"Error loading map. Please check your API key."})}):y?e.jsxs(G,{zoom:13,center:h,mapContainerClassName:"w-full h-full",onClick:t=>{t.latLng&&r({lat:t.latLng.lat(),lng:t.latLng.lng()})},children:[a.map((t,i)=>{var f,b;return e.jsx(K,{position:{lat:((f=t.sellerDetails)==null?void 0:f.Location.coordinates[0])||0,lng:((b=t.sellerDetails)==null?void 0:b.Location.coordinates[1])||0},onClick:()=>u(t)},i)}),n&&e.jsx(k,{position:{lat:((m=n.sellerDetails)==null?void 0:m.Location.coordinates[0])||0,lng:((g=n.sellerDetails)==null?void 0:g.Location.coordinates[1])||0},onCloseClick:()=>u(null),children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:n.name}),e.jsx("p",{className:"text-sm text-gray-600",children:n.email})]})})]}):e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"text-gray-600",children:"Loading map..."})})}o.object({storeName:o.string().min(1,"Store name is required"),longitude:o.number(),latitude:o.number(),Gopa_ID:o.string().min(1,"Please select a Gopa"),User_ID:o.string().min(1,"Please select a user")});function X(){const{data:a,isLoading:s}=T(),r=d.useMemo(()=>(a==null?void 0:a.data)||[],[a==null?void 0:a.data]),[y,x]=d.useState(null);$();const[n,u]=d.useState(null),h=d.useMemo(()=>[{header:"Name",accessorKey:"name"},{header:"Email",accessorKey:"email"},{header:"Phone",accessorKey:"phoneNumber"},{header:"Status",accessorKey:"status",cell:({row:t})=>{const i=t.original.status===1;return e.jsxs("span",{className:j("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",i?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:j("w-1.5 h-1.5 rounded-full mr-1.5",i?"bg-green-400":"bg-red-400")}),i?"Active":"Inactive"]})}},{header:"Date Added",accessorKey:"createdAt",cell:({row:t})=>e.jsx("div",{children:N(t.original.createdAt,"dd/MM/yyyy HH:mm:ss a")})}],[]),m=t=>{x(t),u(t),P.success(`Location selected: ${t.lat.toFixed(6)}, ${t.lng.toFixed(6)}`)},g=[{title:"Total Buyers",value:r.length,Icon:B,description:"Registered buyers",trend:"+3.2%",trendUp:!0},{title:"Active Locations",value:r.length,Icon:F,description:"Service locations",trend:"+2.1%",trendUp:!0},{title:"Assigned Gopas",value:new Set(r.map(t=>{var i;return(i=t.gopa)==null?void 0:i.Gopa_ID}).filter(Boolean)).size,Icon:M,description:"Active Gopas",trend:"+1.5%",trendUp:!0},{title:"Total Products",value:156,Icon:_,description:"Listed products",trend:"+4.3%",trendUp:!0}];return e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(A,{items:E.threeTier("User Management","/user-management","Buyers")}),e.jsx(I,{title:"Buyers",description:"Manage buyers and their locations"}),e.jsx(U,{cards:g}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-6",children:[e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"lg:col-span-4",children:e.jsx(D,{data:r,columns:h,loading:s,tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})}),e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"lg:col-span-2 h-[440px] rounded-lg overflow-hidden border relative md:top-16.5 right-0",children:e.jsx(z,{buyers:r,selectedLocation:y,onLocationSelect:m})})]})]})}export{X as default};
