import{X as k,k as z,j as e,a as g,Y as P,r as m,g as N,Z as V,F as $,C as Q,l as Y,n as M,m as T,t as w}from"./index-Cx3yMQ3f.js";import{D as G}from"./index-D0svd0GM.js";import{C as H}from"./card-grid-C7Gl_Uh6.js";import{u as W,a as X,F as Z,b as C,c as v,d as A,e as I,f as B}from"./form-DABIbnA-.js";import{u as J}from"./useMutation-DdnS_ohS.js";import{u as ee}from"./useQuery-Ly3xzLnF.js";import{s as ae,o as L,a as se,e as re,b as F}from"./index-CJEG_s-O.js";import{D as te,a as ne,b as le,c as ce,d as ie}from"./dialog-OWjewGbD.js";import{I as R}from"./input-BY_FTDhY.js";import{S as oe,a as de,b as me,c as ue,d as E}from"./select-5_mZnO0V.js";import{T as xe}from"./trash-2-78zht_3s.js";import{P as K}from"./plus-BarkCOgP.js";import{B as he,T as fe}from"./tags-D0Rxe520.js";import{f as pe}from"./format-CBpsKyOP.js";import"./table-CbxoolaY.js";import"./sliders-horizontal-CPYaJ2M2.js";import"./x-45uRG9y6.js";import"./arrow-left-CEUZlc21.js";import"./arrow-right-DHaoxvRn.js";import"./card-BtOxIeoK.js";import"./popover-CAKtuJnK.js";import"./globe-CgBe-rT5.js";const u={all:["brands"],detail:a=>[...u.all,"detail",a],lists:()=>[...u.all,"list"],list:a=>[...u.lists(),a],byType:a=>[...u.all,"type",a],stats:()=>[...u.all,"stats"]},ge=a=>ee({queryKey:u.list({}),queryFn:()=>k.getBrands(a)}),ye=()=>{const a=z();return J({mutationFn:x=>k.createBrand({...x,isActive:!1}),onSuccess:()=>{a.invalidateQueries({queryKey:u.all})}})},je=L({name:F().min(1,"Brand name is required"),manufacturer_ID:F().min(1,"Invalid manufacturer ID"),type:re(["CAR","TRUCK","MOTORCYCLE"],{required_error:"Brand type is required"})}),be=L({brands:se(je).min(1,"Add at least one brand")});function Ne({open:a,onOpenChange:x,onSubmit:y}){const t=W({resolver:ae(be),defaultValues:{brands:[{name:"",manufacturer_ID:"",type:"CAR"}]}}),{fields:l,append:f,remove:j}=X({control:t.control,name:"brands"}),o=c=>{y(c.brands),t.reset()};return e.jsx(te,{open:a,onOpenChange:x,children:e.jsxs(ne,{className:"max-w-2xl bg-white",children:[e.jsxs(le,{children:[e.jsx(ce,{className:"text-[#4A36EC] text-xl font-bold",children:"Add Vehicle Brands"}),e.jsx(ie,{className:"text-gray-600",children:"Add one or more vehicle brands to the system"})]}),e.jsx(Z,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(o),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:l.map((c,d)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(C,{control:t.control,name:`brands.${d}.name`,render:({field:i})=>e.jsxs(v,{children:[e.jsx(A,{className:"text-gray-700",children:"Brand Name"}),e.jsx(I,{children:e.jsx(R,{placeholder:"Enter brand name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...i})}),e.jsx(B,{className:"text-red-500"})]})}),e.jsx(C,{control:t.control,name:`brands.${d}.manufacturer_ID`,render:({field:i})=>e.jsxs(v,{children:[e.jsx(A,{className:"text-gray-700",children:"Manufacturer ID"}),e.jsx(I,{children:e.jsx(R,{placeholder:"Enter manufacturer ID",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...i})}),e.jsx(B,{className:"text-red-500"})]})}),e.jsx(C,{control:t.control,name:`brands.${d}.type`,render:({field:i})=>e.jsxs(v,{children:[e.jsx(A,{className:"text-gray-700",children:"Brand Type"}),e.jsxs(oe,{onValueChange:i.onChange,defaultValue:i.value,children:[e.jsx(I,{children:e.jsx(de,{className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",children:e.jsx(me,{placeholder:"Select brand type"})})}),e.jsxs(ue,{children:[e.jsx(E,{value:"CAR",children:"Car"}),e.jsx(E,{value:"TRUCK",children:"Truck"}),e.jsx(E,{value:"MOTORCYCLE",children:"Motorcycle"})]})]}),e.jsx(B,{className:"text-red-500"})]})})]}),l.length>1&&e.jsx(g,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>j(d),children:e.jsx(xe,{className:"w-4 h-4 text-gray-600"})})]},c.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(g,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>f({name:"",manufacturer_ID:"",type:"CAR"}),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(g,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:"Save Brands"})]})]})})]})})}function Ve(){const{data:a,isLoading:x}=P(),[y,t]=m.useState(!1),{data:l,isLoading:f,isError:j}=ge(),o=m.useMemo(()=>(l==null?void 0:l.data)||[],[l==null?void 0:l.data]),c=m.useMemo(()=>a!=null&&a.manufacturers?new Map(a.manufacturers.map(s=>[s.Manufacturer_ID,s])):new Map,[a==null?void 0:a.manufacturers]),d=m.useCallback(s=>{const r=c.get(s);return(r==null?void 0:r.name)||s||"Unknown"},[c]),i=m.useMemo(()=>[{header:"Brand Name",accessorKey:"name",cell:({row:s})=>e.jsx("span",{className:"font-medium",children:s.original.name})},{header:"Brand Type",accessorKey:"type",cell:({row:s})=>e.jsx("span",{className:"capitalize text-gray-600",children:s.original.type.toLowerCase()})},{header:"Manufacturer",accessorKey:"manufacturer_ID",cell:({row:s})=>{var S;const r=s.original,n=r.manufacturer_ID,h=r.manufacturer,p=d(n),q=x&&!(a!=null&&a.manufacturers),b=p===n;return console.log("Debug Brand Manufacturer:",{brandName:s.original.name,manufacturerId:n,nestedManufacturer:h,fullBrandObject:s.original,manufacturerName:p,availableManufacturers:((S=a==null?void 0:a.manufacturers)==null?void 0:S.map(D=>({id:D.Manufacturer_ID,name:D.name})))||[],lookupResult:c.get(n),manufacturerLookupSize:c.size}),q?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}):h!=null&&h.name?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-900",title:h.name,children:h.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["From API: ",n]})]}):n?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:N("font-medium",b?"text-amber-600":"text-gray-900"),title:b?`ID: ${n}`:p,children:p}),b&&e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",n]})]}):e.jsx("span",{className:"text-gray-400",children:"No manufacturer ID"})}},{header:"Status",accessorKey:"status",cell:({row:s})=>{const r=s.original.status===1;return e.jsxs("span",{className:N("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:N("w-1.5 h-1.5 rounded-full mr-1.5",r?"bg-green-400":"bg-red-400")}),r?"Active":"Inactive"]})}},{header:"Added On",accessorKey:"createdAt",cell:({row:s})=>{try{const r=new Date(s.original.createdAt);return e.jsx("span",{className:"text-gray-600",children:pe(r,"dd/MM/yyyy")})}catch{return e.jsx("span",{className:"text-gray-400",children:"Invalid date"})}}}],[d,x,a==null?void 0:a.manufacturers]);m.useEffect(()=>{const s=V.getState().actions.loadInventoryData;s()},[]),m.useEffect(()=>{var s,r,n;a&&console.log("Inventory data loaded:",{manufacturers:((s=a.manufacturers)==null?void 0:s.length)||0,brands:((r=a.brands)==null?void 0:r.length)||0,models:((n=a.models)==null?void 0:n.length)||0})},[a]);const{mutate:_}=ye(),O=async s=>{console.log(s),_(s,{onSuccess:()=>{t(!1),w.success("Brand created successfully")},onError:()=>{t(!1),w.error("Failed to create brand")}})},U=[{title:"Total Brands",value:o.length,Icon:he,description:"Active brands in the system",trend:"+2.1%",trendUp:!0},{title:"Manufacturers",value:new Set(o.map(s=>s.manufacturer_ID)).size,Icon:$,description:"Associated manufacturers",trend:"+1.8%",trendUp:!0},{title:"Car Brands",value:o.filter(s=>s.type==="CAR").length,Icon:Q,description:"Passenger vehicle brands",trend:"+3.4%",trendUp:!0},{title:"Brand Types",value:new Set(o.map(s=>s.type)).size,Icon:fe,description:"Different brand categories",trend:"+1.2%",trendUp:!0}];return f?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(Y,{})}):j?e.jsx("div",{children:"Error loading brands"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx("a",{href:"/",className:"hover:text-[#4A36EC]",children:"Dashboard"}),e.jsx(M,{className:"w-4 h-4 mx-2"}),e.jsx("a",{href:"/inventory",className:"hover:text-[#4A36EC]",children:"Inventory"}),e.jsx(M,{className:"w-4 h-4 mx-2"}),e.jsx("span",{className:"text-[#4A36EC] font-medium",children:"Brands"})]}),e.jsxs(T.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#4A36EC]",children:"Vehicle Brands"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage vehicle brands and their associations"})]}),e.jsxs(g,{onClick:()=>t(!0),className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Brand"]})]}),e.jsx(H,{cards:U}),e.jsx(T.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(G,{data:o,columns:i,loading:f,tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})}),e.jsx(Ne,{open:y,onOpenChange:t,onSubmit:O})]})}export{Ve as default};
