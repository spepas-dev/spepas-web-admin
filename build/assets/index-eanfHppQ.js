import{N as L,b as z,O as R,r as m,j as e,a as g,c as y,i as O,u as V,F as $,C as G,P as Q,m as H,d as k}from"./index-C2Q_LmeJ.js";import{B as Y,a as W,P as J}from"./pageHeader-7vhK00zh.js";import{D as X}from"./index-CvxHYYsL.js";import{u as Z}from"./modal-helpers-CaXMt30Z.js";import{C as ee}from"./card-grid-CZ4tobzV.js";import{u as ae,a as re,F as se,b as I,c as S,d as M,e as w,f as E}from"./form-CcMvRR1f.js";import{u as te}from"./useMutation-TZLAPFAD.js";import{u as ne}from"./useQuery-CUE0UVvY.js";import{s as ce,o as _,b as le,e as oe,a as D}from"./index-DyAPY9a1.js";import{P as ie,a as de,b as me,C as ue,c as pe,d as fe,e as xe,f as he,g as be}from"./popover-CI77UgAE.js";import{I as ge}from"./input-fvZZM-h7.js";import{S as ye,a as je,b as Ce,c as Ne,d as T}from"./select-K8uUziWX.js";import{C as ve}from"./chevrons-up-down-D0EFROM4.js";import{T as Be}from"./trash-2-PgzqsL3V.js";import{P as K}from"./plus-BFloapdy.js";import{B as Ae,T as Ie}from"./tags-gyNW0sJ2.js";import{f as Se}from"./format-CBpsKyOP.js";import"./table-CAIVgxvw.js";import"./dialog-BxdRvcNA.js";import"./arrow-left-DT7SArHl.js";import"./arrow-right-Ct_-AZHB.js";import"./card-CVylEmF3.js";import"./globe-C44rbEdp.js";import"./utils-km2FGkQ4.js";const f={all:["brands"],detail:a=>[...f.all,"detail",a],lists:()=>[...f.all,"list"],list:a=>[...f.lists(),a],byType:a=>[...f.all,"type",a],stats:()=>[...f.all,"stats"]},Me=a=>ne({queryKey:f.list({}),queryFn:()=>L.getBrands(a)}),we=()=>{const a=z();return te({mutationFn:t=>L.createBrand({...t,isActive:!1}),onSuccess:()=>{a.invalidateQueries({queryKey:f.all})}})},Ee=_({name:D().min(1,"Brand name is required"),manufacturer_ID:D().min(1,"Manufacturer ID is required"),type:oe(["CAR","TRUCK","MOTORCYCLE"],{required_error:"Brand type is required"})}),Te=_({brands:le(Ee).min(1,"Add at least one brand")});function Fe({onSubmit:a,loading:t=!1}){const{data:x}=R(),b=m.useMemo(()=>(x==null?void 0:x.manufacturers)||[],[x]),j=m.useMemo(()=>b.map(n=>({id:n.Manufacturer_ID,name:n.name})),[b]),l=ae({resolver:ce(Te),defaultValues:{brands:[{name:"",manufacturer_ID:"",type:"CAR"}]}}),{fields:i,append:C,remove:B}=re({control:l.control,name:"brands"}),u=n=>{a(n.brands),l.reset()};return e.jsx(se,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(u),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:i.map((n,p)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(I,{control:l.control,name:`brands.${p}.name`,render:({field:c})=>e.jsxs(S,{children:[e.jsx(M,{className:"text-gray-700",children:"Brand Name"}),e.jsx(w,{children:e.jsx(ge,{placeholder:"Enter brand name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:t,...c})}),e.jsx(E,{className:"text-red-500"})]})}),e.jsx(I,{control:l.control,name:`brands.${p}.manufacturer_ID`,render:({field:c})=>{var N;return e.jsxs(S,{children:[e.jsx(M,{className:"text-gray-700",children:"Manufacturer"}),e.jsxs(ie,{children:[e.jsx(de,{asChild:!0,children:e.jsx(w,{children:e.jsxs(g,{variant:"outline",role:"combobox",className:y("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!c.value&&"text-muted-foreground"),disabled:t,children:[c.value?(N=j.find(d=>d.id===c.value))==null?void 0:N.name:"Select manufacturer...",e.jsx(ve,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(me,{className:"w-full p-0",children:e.jsxs(ue,{children:[e.jsx(pe,{placeholder:"Search manufacturer..."}),e.jsxs(fe,{children:[e.jsx(xe,{children:"No manufacturer found."}),e.jsx(he,{children:j.map(d=>e.jsxs(be,{value:d.name,onSelect:()=>{c.onChange(d.id)},children:[e.jsx(O,{className:y("mr-2 h-4 w-4",d.id===c.value?"opacity-100":"opacity-0")}),d.name]},d.id))})]})]})})]}),e.jsx(E,{className:"text-red-500"})]})}}),e.jsx(I,{control:l.control,name:`brands.${p}.type`,render:({field:c})=>e.jsxs(S,{children:[e.jsx(M,{className:"text-gray-700",children:"Brand Type"}),e.jsxs(ye,{onValueChange:c.onChange,defaultValue:c.value,disabled:t,children:[e.jsx(w,{children:e.jsx(je,{className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",children:e.jsx(Ce,{placeholder:"Select brand type"})})}),e.jsxs(Ne,{children:[e.jsx(T,{value:"CAR",children:"Car"}),e.jsx(T,{value:"TRUCK",children:"Truck"}),e.jsx(T,{value:"MOTORCYCLE",children:"Motorcycle"})]})]}),e.jsx(E,{className:"text-red-500"})]})})]}),i.length>1&&e.jsx(g,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>B(p),disabled:t,children:e.jsx(Be,{className:"w-4 h-4 text-gray-600"})})]},n.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(g,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>C({name:"",manufacturer_ID:"",type:"CAR"}),disabled:t,children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(g,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:t,children:t?"Saving...":"Save Brands"})]})]})})}function sa(){const{data:a,isLoading:t}=R(),[x,b]=m.useState(!1),j=we(),l=Z(),{data:i,isLoading:C,isError:B}=Me(),u=m.useMemo(()=>(i==null?void 0:i.data)||[],[i==null?void 0:i.data]),n=m.useMemo(()=>a!=null&&a.manufacturers?new Map(a.manufacturers.map(r=>[r.Manufacturer_ID,r])):new Map,[a==null?void 0:a.manufacturers]),p=m.useCallback(r=>{const s=n.get(r);return(s==null?void 0:s.name)||r||"Unknown"},[n]),c=async r=>{b(!0);try{await j.mutateAsync(r),k.success(`${r.length} brand(s) created successfully`),l.close()}catch(s){console.error("Error creating brands:",s),k.error("Failed to create brands. Please try again.")}finally{b(!1)}},N=()=>{l.openForm({title:"Add Vehicle Brands",size:"md",showFooter:!1,children:e.jsx(Fe,{onSubmit:c,loading:x})})},d=m.useMemo(()=>[{header:"Brand Name",accessorKey:"name",cell:({row:r})=>e.jsx("span",{className:"font-medium",children:r.original.name})},{header:"Brand Type",accessorKey:"type",cell:({row:r})=>e.jsx("span",{className:"capitalize text-gray-600",children:r.original.type.toLowerCase()})},{header:"Manufacturer",accessorKey:"manufacturer_ID",cell:({row:r})=>{var F;const s=r.original,o=s.manufacturer_ID,h=s.manufacturer,v=p(o),q=t&&!(a!=null&&a.manufacturers),A=v===o;return console.log("Debug Brand Manufacturer:",{brandName:r.original.name,manufacturerId:o,nestedManufacturer:h,fullBrandObject:r.original,manufacturerName:v,availableManufacturers:((F=a==null?void 0:a.manufacturers)==null?void 0:F.map(P=>({id:P.Manufacturer_ID,name:P.name})))||[],lookupResult:n.get(o),manufacturerLookupSize:n.size}),q?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}):h!=null&&h.name?e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"font-medium text-gray-900",title:h.name,children:h.name})}):o?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:y("font-medium",A?"text-amber-600":"text-gray-900"),title:A?`ID: ${o}`:v,children:v}),A&&e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",o]})]}):e.jsx("span",{className:"text-gray-400",children:"No manufacturer ID"})}},{header:"Status",accessorKey:"status",cell:({row:r})=>{const s=r.original.status===1;return e.jsxs("span",{className:y("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",s?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:y("w-1.5 h-1.5 rounded-full mr-1.5",s?"bg-green-400":"bg-red-400")}),s?"Active":"Inactive"]})}},{header:"Added On",accessorKey:"createdAt",cell:({row:r})=>{try{const s=new Date(r.original.createdAt);return e.jsx("span",{className:"text-gray-600",children:Se(s,"dd/MM/yyyy")})}catch{return e.jsx("span",{className:"text-gray-400",children:"Invalid date"})}}}],[p,t,a==null?void 0:a.manufacturers,n]);m.useEffect(()=>{const r=V.getState().actions.loadInventoryData;r()},[]),m.useEffect(()=>{var r,s,o;a&&console.log("Inventory data loaded:",{manufacturers:((r=a.manufacturers)==null?void 0:r.length)||0,brands:((s=a.brands)==null?void 0:s.length)||0,models:((o=a.models)==null?void 0:o.length)||0})},[a]);const U=[{title:"Total Brands",value:u.length,Icon:Ae,description:"Active brands in the system",trend:"+2.1%",trendUp:!0},{title:"Manufacturers",value:new Set(u.map(r=>r.manufacturer_ID)).size,Icon:$,description:"Associated manufacturers",trend:"+1.8%",trendUp:!0},{title:"Car Brands",value:u.filter(r=>r.type==="CAR").length,Icon:G,description:"Passenger vehicle brands",trend:"+3.4%",trendUp:!0},{title:"Brand Types",value:new Set(u.map(r=>r.type)).size,Icon:Ie,description:"Different brand categories",trend:"+1.2%",trendUp:!0}];return C?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(Q,{})}):B?e.jsx("div",{children:"Error loading brands"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(Y,{items:W.threeTier("Inventory","/inventory","Brands")}),e.jsx(J,{title:"Vehicle Brands",description:"Manage vehicle brands and their associations",actions:e.jsxs(g,{onClick:N,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Add Brand"]})}),e.jsx(ee,{cards:U}),e.jsx(H.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(X,{data:u,columns:d,loading:C,tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{sa as default};
