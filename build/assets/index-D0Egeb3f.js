import{b as M,O as w,r as h,j as e,a as u,c as C,i as F,x as D,C as T,P as k,m as K,d as N}from"./index-C2Q_LmeJ.js";import{B,a as U,P as _}from"./pageHeader-7vhK00zh.js";import{D as q}from"./index-CvxHYYsL.js";import{u as H}from"./modal-helpers-CaXMt30Z.js";import{C as L}from"./card-grid-CZ4tobzV.js";import{u as $,a as G,F as z,b as j,c as b,d as f,e as y,f as g}from"./form-CcMvRR1f.js";import{u as Q}from"./useMutation-TZLAPFAD.js";import{S as O,s as R,u as V}from"./sparepartsQueries-JOE5Efoa.js";import{s as W,o as E,b as J,a as S,n as X}from"./index-DyAPY9a1.js";import{P as Y,a as Z,b as ee,C as re,c as ae,d as se,e as te,f as oe,g as ne}from"./popover-CI77UgAE.js";import{I as A}from"./input-fvZZM-h7.js";import{T as ie}from"./textarea-BuBMhKBk.js";import{C as ce}from"./chevrons-up-down-D0EFROM4.js";import{T as le}from"./trash-2-PgzqsL3V.js";import{P as I}from"./plus-BFloapdy.js";import{C as de}from"./clipboard-list-DtZir6Ey.js";import{P as me}from"./package-C2oDbEcW.js";import{f as pe}from"./format-CBpsKyOP.js";import"./table-CAIVgxvw.js";import"./dialog-BxdRvcNA.js";import"./select-K8uUziWX.js";import"./arrow-left-DT7SArHl.js";import"./arrow-right-Ct_-AZHB.js";import"./card-CVylEmF3.js";import"./globe-C44rbEdp.js";import"./utils-km2FGkQ4.js";import"./useQuery-CUE0UVvY.js";const ue=()=>{const m=M();return Q({mutationFn:a=>O.createSparePart(a),onSuccess:()=>{m.invalidateQueries({queryKey:R.all})}})},he=E({name:S().min(1,"Spare part name is required"),description:S().min(1,"Description is required"),price:X().min(0,"Price must be 0 or greater"),carModel_ID:S().min(1,"Car model ID is required")}),xe=E({spareParts:J(he).min(1,"Add at least one spare part")});function je({onSubmit:m,loading:a=!1}){const{data:l}=w(),p=h.useMemo(()=>(l==null?void 0:l.models)||[],[l]),o=h.useMemo(()=>p.map(n=>({id:n.CarModel_ID,name:n.name})),[p]),s=$({resolver:W(xe),defaultValues:{spareParts:[{name:"",description:"",price:0,carModel_ID:""}]}}),{fields:x,append:d,remove:P}=G({control:s.control,name:"spareParts"}),v=n=>{m(n.spareParts),s.reset()};return e.jsx(z,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(v),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:x.map((n,i)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(j,{control:s.control,name:`spareParts.${i}.name`,render:({field:r})=>e.jsxs(b,{children:[e.jsx(f,{className:"text-gray-700",children:"Part Name"}),e.jsx(y,{children:e.jsx(A,{placeholder:"Enter part name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...r})}),e.jsx(g,{className:"text-red-500"})]})}),e.jsx(j,{control:s.control,name:`spareParts.${i}.description`,render:({field:r})=>e.jsxs(b,{children:[e.jsx(f,{className:"text-gray-700",children:"Description"}),e.jsx(y,{children:e.jsx(ie,{placeholder:"Enter part description",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...r})}),e.jsx(g,{className:"text-red-500"})]})}),e.jsx(j,{control:s.control,name:`spareParts.${i}.price`,render:({field:r})=>e.jsxs(b,{children:[e.jsx(f,{className:"text-gray-700",children:"Price"}),e.jsx(y,{children:e.jsx(A,{type:"number",step:"0.01",placeholder:"Enter price",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...r,onChange:t=>r.onChange(parseFloat(t.target.value)||0)})}),e.jsx(g,{className:"text-red-500"})]})}),e.jsx(j,{control:s.control,name:`spareParts.${i}.carModel_ID`,render:({field:r})=>{var t;return e.jsxs(b,{children:[e.jsx(f,{className:"text-gray-700",children:"Car Model"}),e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(y,{children:e.jsxs(u,{variant:"outline",role:"combobox",className:C("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!r.value&&"text-muted-foreground"),disabled:a,children:[r.value?(t=o.find(c=>c.id===r.value))==null?void 0:t.name:"Select car model...",e.jsx(ce,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(ee,{className:"w-full p-0",children:e.jsxs(re,{children:[e.jsx(ae,{placeholder:"Search car model..."}),e.jsxs(se,{children:[e.jsx(te,{children:"No car model found."}),e.jsx(oe,{children:o.map(c=>e.jsxs(ne,{value:c.name,onSelect:()=>{r.onChange(c.id)},children:[e.jsx(F,{className:C("mr-2 h-4 w-4",c.id===r.value?"opacity-100":"opacity-0")}),c.name]},c.id))})]})]})})]}),e.jsx(g,{className:"text-red-500"})]})}})]}),x.length>1&&e.jsx(u,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>P(i),disabled:a,children:e.jsx(le,{className:"w-4 h-4 text-gray-600"})})]},n.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(u,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>d({name:"",description:"",price:0,carModel_ID:""}),disabled:a,children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(u,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:a,children:a?"Saving...":"Save Spare Parts"})]})]})})}function ze(){const[m,a]=h.useState(!1),l=ue(),p=H(),{data:o,isLoading:s,isError:x}=V(),d=h.useMemo(()=>(o==null?void 0:o.data)||[],[o==null?void 0:o.data]),P=async r=>{a(!0);try{await l.mutateAsync(r),N.success(`${r.length} spare part(s) created successfully`),p.close()}catch(t){console.error("Error creating spare parts:",t),N.error("Failed to create spare parts. Please try again.")}finally{a(!1)}},v=()=>{p.openForm({title:"Add Spare Parts",size:"md",showFooter:!1,children:e.jsx(je,{onSubmit:P,loading:m})})},n=h.useMemo(()=>[{header:"Name of Part",accessorKey:"name"},{header:"Description",accessorKey:"description"},{header:"Status",accessorKey:"status",cell:({row:r})=>{const t=r.original.status===1;return e.jsxs("span",{className:C("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",t?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:C("w-1.5 h-1.5 rounded-full mr-1.5",t?"bg-green-400":"bg-red-400")}),t?"Active":"Inactive"]})}},{header:"Price",accessorKey:"price",cell:({row:r})=>e.jsx("div",{children:new Intl.NumberFormat("en-US",{style:"currency",currency:"GHS"}).format(r.original.price)})},{header:"Created At",accessorKey:"createdAt",cell:({row:r})=>e.jsx("div",{children:pe(new Date(r.original.createdAt),"yyyy/MM/dd HH:mm:a")})}],[]),i=[{title:"Total Parts",value:d.length,Icon:D,description:"Active spare parts in system",trend:"+4.3%",trendUp:!0},{title:"Car Models",value:new Set(d.map(r=>r.carModel_ID)).size,Icon:T,description:"Compatible car models",trend:"+2.7%",trendUp:!0},{title:"Categories",value:12,Icon:de,description:"Part categories",trend:"+1.5%",trendUp:!0},{title:"In Stock",value:d.length,Icon:me,description:"Available inventory",trend:"-0.8%",trendUp:!1}];return s?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(k,{})}):x?e.jsx("div",{children:"Error loading spare parts"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(B,{items:U.threeTier("Inventory","/inventory","Spare Parts")}),e.jsx(_,{title:"Spare Parts",description:"Manage spare parts and their specifications",actions:e.jsxs(u,{onClick:v,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Add Spare Part"]})}),e.jsx(L,{cards:i}),e.jsx(K.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(q,{columns:n,data:d,placeholder:"Search spare parts...",tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{ze as default};
