import{z as h,y as $,E as k,f as T,r as d,j as e,g as z,F as B,i as v,k as N,l as S,n as A,o as E,I as _,e as L,G,p as F,ay as q,aV as Q,U as W,s as R,v as V,w as H,C as O,m as I,D as Z,x as C}from"./index-BEfPUQd3.js";import{u as J}from"./modal-helpers-u5ghZSiS.js";import{u as X}from"./useMutation-CxnX3va-.js";import{u as w,G as D,M as P,I as Y,a as ee}from"./esm-Dq51DQsy.js";import{s as se}from"./zod-DPUoip6C.js";import{z as g}from"./index-3Gi9B8Cu.js";import{M as ae}from"./multi-select-DEp3z63F.js";import{u as te}from"./users.queries-BzwIn2G9.js";import{U as re}from"./user-NtLM3mmy.js";import{P as ne}from"./plus-D6nxsE-o.js";import"./dialog-DfEuW_jS.js";import"./separator-DpEqoi9c.js";import"./circle-x-Bb9PP882.js";const x=$.USER_MANAGEMENT.MEPA;class K{static async registerMepa(a){return h.post(`${x.CREATE}`,a)}static async getMepa(a){return h.get(`${x}/${a}`)}static async updateMepa(a,r){return h.put(`${x}/${a}`,r)}static async deleteMepa(a){return h.delete(`${x}/${a}`)}static async getMepaStats(a){return h.get(`${x}/${a}/stats`)}static async getMepaList(a){return h.get(`${x.BASE}`,{params:a})}}const M={all:["mepas"],list:()=>[...M.all,"list"],details:t=>[...M.all,"details",t],stats:t=>[...M.all,"stats",t]},le=()=>k({queryKey:M.list(),queryFn:()=>K.getMepaList()}),ie=()=>{const t=T();return X({mutationFn:a=>K.registerMepa(a),onSuccess:()=>{t.invalidateQueries({queryKey:M.all})}})},oe=["places"];function ce({mechanics:t,selectedLocation:a,onLocationSelect:r}){var n,u;const{isLoaded:y,loadError:j}=w({googleMapsApiKey:"AIzaSyDLsZ984L00maH7hl__gWQ-v7U-KWOEnfU",libraries:oe}),[i,c]=d.useState(null),f=d.useMemo(()=>a||{lat:5.6037,lng:-.187},[a]);return j?e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"text-red-600",children:"Error loading map. Please check your API key."})}):y?e.jsxs(D,{zoom:13,center:f,mapContainerClassName:"w-full h-full",onClick:s=>{s.latLng&&r({lat:s.latLng.lat(),lng:s.latLng.lng()})},children:[t.map((s,m)=>{var p,b;return e.jsx(P,{position:{lat:(p=s.location)==null?void 0:p.coordinates[0],lng:(b=s.location)==null?void 0:b.coordinates[1]},onClick:()=>c(s)},m)}),i&&e.jsx(Y,{position:{lat:(n=i.location)==null?void 0:n.coordinates[0],lng:(u=i.location)==null?void 0:u.coordinates[1]},onCloseClick:()=>c(null),children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:i.shop_name}),e.jsx("p",{className:"text-sm text-gray-600",children:i.address})]})})]}):e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"text-gray-600",children:"Loading map..."})})}const de=g.object({shop_name:g.string().min(1,"Shop name is required"),address:g.string().min(1,"Address is required"),longitude:g.number(),latitude:g.number(),User_ID:g.string().min(1,"Please select a user")}),me=["places"];function ue({onSubmit:t,loading:a=!1,selectedLocation:r}){const{isLoaded:y,loadError:j}=w({googleMapsApiKey:"AIzaSyDLsZ984L00maH7hl__gWQ-v7U-KWOEnfU",libraries:me}),i=d.useMemo(()=>({lat:5.6037,lng:-.187}),[]),{data:c}=te(),f=d.useMemo(()=>(c==null?void 0:c.data.map(s=>({value:s.User_ID,label:s.name,icon:re})))||[],[c]),n=z({resolver:se(de),defaultValues:{shop_name:"",address:"",longitude:(r==null?void 0:r.lng)||i.lng,latitude:(r==null?void 0:r.lat)||i.lat,User_ID:""}}),u=s=>{const m={shop_name:s.shop_name,address:s.address,longitude:s.longitude,latitude:s.latitude,User_ID:s.User_ID};try{t(m)}catch(p){console.error(p)}finally{n.reset()}};return j?e.jsx("div",{children:"Error loading map"}):y?e.jsx(B,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(u),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex gap-4 items-start",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(v,{control:n.control,name:"User_ID",render:({field:s})=>e.jsxs(N,{children:[e.jsx(S,{className:"text-gray-700",children:"Select User"}),e.jsx(A,{children:e.jsx(ae,{options:f,value:[s.value],onValueChange:m=>s.onChange(m[0]),placeholder:"Select a user",maxCount:1,disabled:a})}),e.jsx(E,{className:"text-red-500"})]})}),e.jsx(v,{control:n.control,name:"shop_name",render:({field:s})=>e.jsxs(N,{children:[e.jsx(S,{className:"text-gray-700",children:"Shop Name"}),e.jsx(A,{children:e.jsx(_,{placeholder:"Enter shop name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...s})}),e.jsx(E,{className:"text-red-500"})]})}),e.jsx(v,{control:n.control,name:"address",render:({field:s})=>e.jsxs(N,{children:[e.jsx(S,{className:"text-gray-700",children:"Address"}),e.jsx(A,{children:e.jsx(_,{placeholder:"Enter address",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:a,...s})}),e.jsx(E,{className:"text-red-500"})]})}),e.jsx("div",{className:"h-[200px] rounded-lg overflow-hidden",children:e.jsx(D,{zoom:13,center:i,mapContainerClassName:"w-full h-full",onClick:s=>{s.latLng&&(n.setValue("latitude",s.latLng.lat()),n.setValue("longitude",s.latLng.lng()))},children:e.jsx(P,{position:{lat:n.watch("latitude"),lng:n.watch("longitude")}})})})]})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(L,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:a,children:a?"Saving...":"Save Mechanic"})})]})}):e.jsx("div",{children:"Loading..."})}function Ee(){const{data:t,isLoading:a}=le(),r=d.useMemo(()=>(t==null?void 0:t.data)||[],[t==null?void 0:t.data]),[y,j]=d.useState(null),i=J(),[c,f]=d.useState(null),n=d.useMemo(()=>[{header:"Name",accessorKey:"name"},{header:"Email",accessorKey:"email"},{header:"Phone",accessorKey:"phoneNumber"},{header:"User Type",accessorKey:"user_type",cell:({row:l})=>{const o=l.original.user_type;return e.jsx(G,{variant:"outline",children:String(o.charAt(0).toUpperCase()+o.slice(1)).replace(/_/g," ")})}},{header:"Status",accessorKey:"status",cell:({row:l})=>{const o=l.original.status===1;return e.jsxs("span",{className:F("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:F("w-1.5 h-1.5 rounded-full mr-1.5",o?"bg-green-400":"bg-red-400")}),o?"Active":"Inactive"]})}},{header:"Date Added",accessorKey:"createdAt",cell:({row:l})=>e.jsx("div",{children:new Date(l.original.createdAt).toLocaleDateString()})}],[]),u=()=>{i.openForm({title:"Add New Mechanic Shop",children:e.jsx(ue,{onSubmit:p,loading:!1,selectedLocation:c}),showFooter:!1})},s=l=>{j(l),f(l),C.success(`Location selected: ${l.lat.toFixed(6)}, ${l.lng.toFixed(6)}`)},{mutateAsync:m}=ie(),p=async l=>{try{const o=await m(l);console.log("response =>>>",o),C.success("Mechanic shop created successfully"),i.close()}catch{C.error("Failed to create mechanic shop")}},b=[{title:"Total Mechanics",value:r.length,Icon:q,description:"Registered mechanic shops",trend:"+2.5%",trendUp:!0},{title:"Active Locations",value:r.length,Icon:ee,description:"Service locations",trend:"+1.8%",trendUp:!0},{title:"Shop Types",value:12,Icon:Q,description:"Different specializations",trend:"+3.2%",trendUp:!0},{title:"Service Areas",value:new Set(r.map(l=>{var o,U;return(U=(o=l.address)==null?void 0:o.split(",").pop())==null?void 0:U.trim()})).size,Icon:W,description:"Areas covered",trend:"+0.9%",trendUp:!0}];return e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(R,{items:V.threeTier("User Management","/user-management","Mepas")}),e.jsx(H,{title:"Mepas",description:"Manage mepas and their locations",actions:e.jsxs(L,{onClick:u,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Add Mechanic Shop"]})}),e.jsx(O,{cards:b}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-6",children:[e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"lg:col-span-4",children:e.jsx(Z,{data:r,columns:n,loading:a,tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})}),e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"lg:col-span-2 h-[400px] rounded-lg overflow-hidden border",children:e.jsx(ce,{mechanics:r,selectedLocation:y,onLocationSelect:s})})]})]})}export{Ee as default};
