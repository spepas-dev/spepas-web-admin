import{_,k as U,j as e,a as p,r as m,Y as q,Z as P,g as b,C as $,F as Q,y as R,l as V,n as F,m as S,t as k}from"./index-Cx3yMQ3f.js";import{D as z}from"./index-D0svd0GM.js";import{C as G}from"./card-grid-C7Gl_Uh6.js";import{u as H,a as Z,F as J,b as N,c as M,d as C,e as v,f as A}from"./form-DABIbnA-.js";import{u as W}from"./useMutation-DdnS_ohS.js";import{u as X}from"./useQuery-Ly3xzLnF.js";import{s as ee,o as O,a as ae,n as se,b as B}from"./index-CJEG_s-O.js";import{D as re,a as te,b as ne,c as le,d as oe}from"./dialog-OWjewGbD.js";import{I}from"./input-BY_FTDhY.js";import{T as ce}from"./trash-2-78zht_3s.js";import{P as T}from"./plus-BarkCOgP.js";import{C as ie}from"./calendar-Da5rznX3.js";import"./table-CbxoolaY.js";import"./sliders-horizontal-CPYaJ2M2.js";import"./x-45uRG9y6.js";import"./select-5_mZnO0V.js";import"./arrow-left-CEUZlc21.js";import"./arrow-right-DHaoxvRn.js";import"./card-BtOxIeoK.js";import"./popover-CAKtuJnK.js";import"./globe-CgBe-rT5.js";const u={all:["models"],detail:t=>[...u.all,"detail",t],lists:()=>[...u.all,"list"],list:t=>[...u.lists(),t],stats:()=>[...u.all,"stats"]},de=t=>X({queryKey:u.list({}),queryFn:()=>_.getCarModels(t)}),me=()=>{const t=U();return W({mutationFn:o=>_.createCarModel(o),onSuccess:()=>{t.invalidateQueries({queryKey:u.all})}})},ue=O({name:B().min(1,"Model name is required"),carBrand_ID:B().min(1,"Invalid manufacturer ID"),yearOfMake:se().min(1900).max(new Date().getFullYear()+1)}),xe=O({models:ae(ue).min(1,"Add at least one model")});function he({open:t,onOpenChange:o,onSubmit:c}){const l=H({resolver:ee(xe),defaultValues:{models:[{name:"",carBrand_ID:"",yearOfMake:new Date().getFullYear()}]}}),{fields:x,append:i,remove:g}=Z({control:l.control,name:"models"}),j=a=>{c(a.models),l.reset()};return e.jsx(re,{open:t,onOpenChange:o,children:e.jsxs(te,{className:"max-w-2xl bg-white",children:[e.jsxs(ne,{children:[e.jsx(le,{className:"text-[#4A36EC] text-xl font-bold",children:"Add Vehicle Models"}),e.jsx(oe,{className:"text-gray-600",children:"Add one or more vehicle models to the system"})]}),e.jsx(J,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(j),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:x.map((a,d)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(N,{control:l.control,name:`models.${d}.name`,render:({field:n})=>e.jsxs(M,{children:[e.jsx(C,{className:"text-gray-700",children:"Model Name"}),e.jsx(v,{children:e.jsx(I,{placeholder:"Enter model name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...n})}),e.jsx(A,{className:"text-red-500"})]})}),e.jsx(N,{control:l.control,name:`models.${d}.carBrand_ID`,render:({field:n})=>e.jsxs(M,{children:[e.jsx(C,{className:"text-gray-700",children:"Manufacturer ID"}),e.jsx(v,{children:e.jsx(I,{placeholder:"Enter manufacturer ID",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...n})}),e.jsx(A,{className:"text-red-500"})]})}),e.jsx(N,{control:l.control,name:`models.${d}.yearOfMake`,render:({field:n})=>e.jsxs(M,{children:[e.jsx(C,{className:"text-gray-700",children:"Year"}),e.jsx(v,{children:e.jsx(I,{type:"number",placeholder:"Enter year",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...n,onChange:h=>n.onChange(parseInt(h.target.value))})}),e.jsx(A,{className:"text-red-500"})]})})]}),x.length>1&&e.jsx(p,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>g(d),children:e.jsx(ce,{className:"w-4 h-4 text-gray-600"})})]},a.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(p,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>i({name:"",carBrand_ID:"",yearOfMake:new Date().getFullYear()}),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(p,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:"Save Models"})]})]})})]})})}function Te(){const[t,o]=m.useState(!1),{data:c,isLoading:l,isError:x}=de(),i=m.useMemo(()=>(c==null?void 0:c.data)||[],[c==null?void 0:c.data]),{mutate:g}=me(),j=async s=>{console.log(s),g(s,{onSuccess:()=>{o(!1),k.success("Model created successfully")},onError:()=>{o(!1),k.error("Failed to create model")}})},{data:a,isLoading:d}=q();m.useEffect(()=>{const s=P.getState().actions.loadInventoryData;s()},[]);const n=m.useMemo(()=>a!=null&&a.manufacturers?new Map(a.manufacturers.map(s=>[s.Manufacturer_ID,s])):new Map,[a==null?void 0:a.manufacturers]),h=m.useCallback(s=>{const r=n.get(s);return(r==null?void 0:r.name)||s||"Unknown"},[n]),L=m.useMemo(()=>[{header:"Name of Model",accessorKey:"name"},{header:"Manufacturer",accessorKey:"carBrand.manufacturer_ID",cell:({row:s})=>{var E,D;const r=(E=s.original.carBrand)==null?void 0:E.manufacturer_ID,f=h(r||""),Y=d&&!(a!=null&&a.manufacturers),y=f===r;return console.log("Debug Models Manufacturer:",{modelName:s.original.name,carBrand:s.original.carBrand,manufacturerId:r,manufacturerName:f,availableManufacturers:((D=a==null?void 0:a.manufacturers)==null?void 0:D.map(w=>({id:w.Manufacturer_ID,name:w.name})))||[],lookupResult:n.get(r||"")}),Y?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}):r?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:b("font-medium",y?"text-amber-600":"text-gray-900"),title:y?`ID: ${r}`:f,children:f}),y&&e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",r]})]}):e.jsx("span",{className:"text-gray-400",children:"No manufacturer"})}},{header:"Status",accessorKey:"status",cell:({row:s})=>{const r=s.original.status===1;return e.jsxs("span",{className:b("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:b("w-1.5 h-1.5 rounded-full mr-1.5",r?"bg-green-400":"bg-red-400")}),r?"Active":"Inactive"]})}},{header:"Year of Make",accessorKey:"yearOfMake"}],[h,a==null?void 0:a.manufacturers,d]),K=[{title:"Total Models",value:i.length,Icon:$,description:"Active car models in the system",trend:"+3.2%",trendUp:!0},{title:"Latest Year",value:i.length>0?Math.max(...i.map(s=>s.yearOfMake)):0,Icon:ie,description:"Most recent model year",trend:"+1.5%",trendUp:!0},{title:"Manufacturers",value:new Set(i.map(s=>s.carBrand_ID)).size,Icon:Q,description:"Associated manufacturers",trend:"+2.8%",trendUp:!0},{title:"Parts Categories",value:89,Icon:R,description:"Compatible parts categories",trend:"+4.1%",trendUp:!0}];return l?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(V,{})}):x?e.jsx("div",{children:"Error loading models"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx("a",{href:"/",className:"hover:text-[#4A36EC]",children:"Dashboard"}),e.jsx(F,{className:"w-4 h-4 mx-2"}),e.jsx("a",{href:"/inventory",className:"hover:text-[#4A36EC]",children:"Inventory"}),e.jsx(F,{className:"w-4 h-4 mx-2"}),e.jsx("span",{className:"text-[#4A36EC] font-medium",children:"Models"})]}),e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[#4A36EC]",children:"Vehicle Models"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage vehicle models and their specifications"})]}),e.jsxs(p,{onClick:()=>o(!0),className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Add Model"]})]}),e.jsx(G,{cards:K}),e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(z,{columns:L,data:i,placeholder:"Seach models...",tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})}),e.jsx(he,{open:t,onOpenChange:o,onSubmit:j})]})}export{Te as default};
