import{Q as z,b as W,O as G,r as x,j as e,a as j,c as p,i as P,u as X,C as Z,F as ee,q as ae,P as se,m as re,d as D}from"./index-C2Q_LmeJ.js";import{B as te,a as ne,P as oe}from"./pageHeader-7vhK00zh.js";import{D as le}from"./index-CvxHYYsL.js";import{u as ce}from"./modal-helpers-CaXMt30Z.js";import{C as ie}from"./card-grid-CZ4tobzV.js";import{u as de,a as me,F as ue,b as w,c as S,d as I,e as A,f as F}from"./form-CcMvRR1f.js";import{u as xe}from"./useMutation-TZLAPFAD.js";import{u as he}from"./useQuery-CUE0UVvY.js";import{s as pe,o as V,b as fe,n as je,a as Y}from"./index-DyAPY9a1.js";import{P as T,a as _,b as L,C as q,c as K,d as O,e as U,f as $,g as Q}from"./popover-CI77UgAE.js";import{I as ge}from"./input-fvZZM-h7.js";import{C as be}from"./chevrons-up-down-D0EFROM4.js";import{C as H}from"./calendar-BQaF4Hb-.js";import{T as ye}from"./trash-2-PgzqsL3V.js";import{P as R}from"./plus-BFloapdy.js";import"./table-CAIVgxvw.js";import"./dialog-BxdRvcNA.js";import"./select-K8uUziWX.js";import"./arrow-left-DT7SArHl.js";import"./arrow-right-Ct_-AZHB.js";import"./card-CVylEmF3.js";import"./globe-C44rbEdp.js";import"./utils-km2FGkQ4.js";const g={all:["models"],detail:o=>[...g.all,"detail",o],lists:()=>[...g.all,"list"],list:o=>[...g.lists(),o],stats:()=>[...g.all,"stats"]},Me=o=>he({queryKey:g.list({}),queryFn:()=>z.getCarModels(o)}),Ce=()=>{const o=W();return xe({mutationFn:n=>z.createCarModel(n),onSuccess:()=>{o.invalidateQueries({queryKey:g.all})}})},Ne=V({name:Y().min(1,"Model name is required"),carBrand_ID:Y().min(1,"Car brand ID is required"),yearOfMake:je().min(1900,"Year must be 1900 or later").max(new Date().getFullYear()+1,"Year cannot be in the future")}),ve=V({models:fe(Ne).min(1,"Add at least one model")});function we({onSubmit:o,loading:n=!1}){const{data:f}=G(),b=x.useMemo(()=>(f==null?void 0:f.brands)||[],[f]),d=x.useMemo(()=>b.map(l=>({id:l.CarBrand_ID,name:l.name})),[b]),M=x.useMemo(()=>{const l=new Date().getFullYear(),c=[];for(let a=l+1;a>=1900;a--)c.push(a);return c},[]),m=de({resolver:pe(ve),defaultValues:{models:[{name:"",carBrand_ID:"",yearOfMake:new Date().getFullYear()}]}}),{fields:h,append:C,remove:N}=me({control:m.control,name:"models"}),r=l=>{o(l.models),m.reset()};return e.jsx(ue,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(r),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:h.map((l,c)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(w,{control:m.control,name:`models.${c}.name`,render:({field:a})=>e.jsxs(S,{children:[e.jsx(I,{className:"text-gray-700",children:"Model Name"}),e.jsx(A,{children:e.jsx(ge,{placeholder:"Enter model name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:n,...a})}),e.jsx(F,{className:"text-red-500"})]})}),e.jsx(w,{control:m.control,name:`models.${c}.carBrand_ID`,render:({field:a})=>{var i;return e.jsxs(S,{children:[e.jsx(I,{className:"text-gray-700",children:"Car Brand"}),e.jsxs(T,{children:[e.jsx(_,{asChild:!0,children:e.jsx(A,{children:e.jsxs(j,{variant:"outline",role:"combobox",className:p("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!a.value&&"text-muted-foreground"),disabled:n,children:[a.value?(i=d.find(u=>u.id===a.value))==null?void 0:i.name:"Select car brand...",e.jsx(be,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(L,{className:"w-full p-0",children:e.jsxs(q,{children:[e.jsx(K,{placeholder:"Search car brand..."}),e.jsxs(O,{children:[e.jsx(U,{children:"No car brand found."}),e.jsx($,{children:d.map(u=>e.jsxs(Q,{value:u.name,onSelect:()=>{a.onChange(u.id)},children:[e.jsx(P,{className:p("mr-2 h-4 w-4",u.id===a.value?"opacity-100":"opacity-0")}),u.name]},u.id))})]})]})})]}),e.jsx(F,{className:"text-red-500"})]})}}),e.jsx(w,{control:m.control,name:`models.${c}.yearOfMake`,render:({field:a})=>e.jsxs(S,{children:[e.jsx(I,{className:"text-gray-700",children:"Year of Make"}),e.jsxs(T,{children:[e.jsx(_,{asChild:!0,children:e.jsx(A,{children:e.jsxs(j,{variant:"outline",role:"combobox",className:p("w-full justify-between border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",!a.value&&"text-muted-foreground"),disabled:n,children:[a.value?a.value.toString():"Select year...",e.jsx(H,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(L,{className:"w-full p-0",children:e.jsxs(q,{children:[e.jsx(K,{placeholder:"Search year..."}),e.jsxs(O,{children:[e.jsx(U,{children:"No year found."}),e.jsx($,{children:M.map(i=>e.jsxs(Q,{value:i.toString(),onSelect:()=>{a.onChange(i)},children:[e.jsx(P,{className:p("mr-2 h-4 w-4",i===a.value?"opacity-100":"opacity-0")}),i]},i))})]})]})})]}),e.jsx(F,{className:"text-red-500"})]})})]}),h.length>1&&e.jsx(j,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>N(c),disabled:n,children:e.jsx(ye,{className:"w-4 h-4 text-gray-600"})})]},l.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(j,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>C({name:"",carBrand_ID:"",yearOfMake:new Date().getFullYear()}),disabled:n,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(j,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:n,children:n?"Saving...":"Save Models"})]})]})})}function Re(){const[o,n]=x.useState(!1),f=Ce(),b=ce(),{data:d,isLoading:M,isError:m}=Me(),h=x.useMemo(()=>(d==null?void 0:d.data)||[],[d==null?void 0:d.data]),C=async s=>{n(!0);try{await f.mutateAsync(s),D.success(`${s.length} model(s) created successfully`),b.close()}catch(t){console.error("Error creating models:",t),D.error("Failed to create models. Please try again.")}finally{n(!1)}},N=()=>{b.openForm({title:"Add Vehicle Models",size:"md",showFooter:!1,children:e.jsx(we,{onSubmit:C,loading:o})})},{data:r,isLoading:l}=G();x.useEffect(()=>{const s=X.getState().actions.loadInventoryData;s()},[]);const c=x.useMemo(()=>r!=null&&r.manufacturers?new Map(r.manufacturers.map(s=>[s.Manufacturer_ID,s])):new Map,[r==null?void 0:r.manufacturers]),a=x.useCallback(s=>{const t=c.get(s);return(t==null?void 0:t.name)||s||"Unknown"},[c]),i=x.useMemo(()=>[{header:"Name of Model",accessorKey:"name"},{header:"Manufacturer",accessorKey:"carBrand.manufacturer_ID",cell:({row:s})=>{var E,k;const t=(E=s.original.carBrand)==null?void 0:E.manufacturer_ID,y=a(t||""),J=l&&!(r!=null&&r.manufacturers),v=y===t;return console.log("Debug Models Manufacturer:",{modelName:s.original.name,carBrand:s.original.carBrand,manufacturerId:t,manufacturerName:y,availableManufacturers:((k=r==null?void 0:r.manufacturers)==null?void 0:k.map(B=>({id:B.Manufacturer_ID,name:B.name})))||[],lookupResult:c.get(t||"")}),J?e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"})}):t?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:p("font-medium",v?"text-amber-600":"text-gray-900"),title:v?`ID: ${t}`:y,children:y}),v&&e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",t]})]}):e.jsx("span",{className:"text-gray-400",children:"No manufacturer"})}},{header:"Status",accessorKey:"status",cell:({row:s})=>{const t=s.original.status===1;return e.jsxs("span",{className:p("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",t?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:p("w-1.5 h-1.5 rounded-full mr-1.5",t?"bg-green-400":"bg-red-400")}),t?"Active":"Inactive"]})}},{header:"Year of Make",accessorKey:"yearOfMake"}],[a,r==null?void 0:r.manufacturers,l]),u=[{title:"Total Models",value:h.length,Icon:Z,description:"Active car models in the system",trend:"+3.2%",trendUp:!0},{title:"Latest Year",value:h.length>0?Math.max(...h.map(s=>s.yearOfMake)):0,Icon:H,description:"Most recent model year",trend:"+1.5%",trendUp:!0},{title:"Manufacturers",value:new Set(h.map(s=>s.carBrand_ID)).size,Icon:ee,description:"Associated manufacturers",trend:"+2.8%",trendUp:!0},{title:"Parts Categories",value:89,Icon:ae,description:"Compatible parts categories",trend:"+4.1%",trendUp:!0}];return M?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(se,{})}):m?e.jsx("div",{children:"Error loading models"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(te,{items:ne.threeTier("Inventory","/inventory","Models")}),e.jsx(oe,{title:"Vehicle Models",description:"Manage vehicle models and their specifications",actions:e.jsxs(j,{onClick:N,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Add Model"]})}),e.jsx(ie,{cards:u}),e.jsx(re.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(le,{columns:i,data:h,placeholder:"Search models...",tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{Re as default};
