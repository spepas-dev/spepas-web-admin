import{c as w,f as F,t as S,g as M,h as k,j as e,F as I,i as x,k as y,l as f,n as g,I as L,o as j,e as p,r as h,p as b,q as T,S as D,U,P as q,s as K,v as B,w as z,C as G,m as _,D as H,x as P}from"./index-BEfPUQd3.js";import{u as Q}from"./modal-helpers-u5ghZSiS.js";import{u as V}from"./useMutation-CxnX3va-.js";import{P as $,p as O,u as R}from"./permission.queries-BW_YAYP2.js";import{s as Z}from"./zod-DPUoip6C.js";import{o as C,s as v,a as J}from"./index-3Gi9B8Cu.js";import{T as W}from"./textarea-BpM5EgwI.js";import{T as X}from"./trash-2-DQhLckhX.js";import{P as A}from"./plus-D6nxsE-o.js";import{L as Y}from"./loader-circle-DSPkz6nm.js";import{L as ee}from"./lock-BqMNhkTp.js";import"./dialog-DfEuW_jS.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],re=w("FileCheck",se),ie=()=>{const r=F();return V({mutationFn:i=>$.createPermission(i),onSuccess:()=>{r.invalidateQueries({queryKey:O.all}),S.success("Permission created successfully")}})},te=C({title:v().min(1,"Permission name is required"),description:v().min(10,"Description must be at least 10 characters")}),ae=C({permissions:J(te).min(1,"Add at least one permission")}),N={title:"",description:""};function ne({onSubmit:r,loading:i=!1}){const s=M({resolver:Z(ae),defaultValues:{permissions:[N]}}),{fields:c,append:t,remove:u}=k({control:s.control,name:"permissions"}),d=m=>{const a=m.permissions.map(n=>({title:n.title}));r(a),s.reset()};return e.jsx(I,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(d),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:c.map((m,a)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(x,{control:s.control,name:`permissions.${a}.title`,render:({field:n})=>e.jsxs(y,{children:[e.jsx(f,{className:"text-gray-700",children:"Permission Name"}),e.jsx(g,{children:e.jsx(L,{placeholder:"Enter permission name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...n})}),e.jsx(j,{className:"text-red-500"})]})}),e.jsx(x,{control:s.control,name:`permissions.${a}.description`,render:({field:n})=>e.jsxs(y,{children:[e.jsx(f,{className:"text-gray-700",children:"Description"}),e.jsx(g,{children:e.jsx(W,{placeholder:"Enter permission description",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...n})}),e.jsx(j,{className:"text-red-500"})]})})]}),c.length>1&&e.jsx(p,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>u(a),children:e.jsx(X,{className:"w-4 h-4 text-gray-600"})})]},m.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(p,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>t(N),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(p,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:i,children:i?e.jsx(Y,{className:"w-4 h-4 mr-2 animate-spin"}):"Save Permissions"})]})]})})}function je(){const[r,i]=h.useState([]),s=ie(),c=Q(),{data:t,isError:u,isLoading:d}=R();h.useEffect(()=>(t&&i(t.data),()=>{i([])}),[t==null?void 0:t.data]);const m=h.useMemo(()=>[{header:"Permission Name",accessorKey:"title"},{header:"Description",accessorKey:"description"},{header:"Status",accessorKey:"status",cell:({row:o})=>{const l=o.original.status===1;return e.jsxs("span",{className:b("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",l?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:b("w-1.5 h-1.5 rounded-full mr-1.5",l?"bg-green-400":"bg-red-400")}),l?"Active":"Inactive"]})}},{header:"Created On",accessorKey:"date_added",cell:({row:o})=>e.jsx("span",{className:"text-gray-600",children:T(new Date(o.original.date_added),"dd/MM/yyyy")})}],[]),a=async o=>{try{await s.mutateAsync(o),P.success("Permission(s) created successfully"),c.close()}catch(l){console.error("Error creating permission:",l),P.error("Failed to create permission. Please try again.")}},n=()=>{c.openForm({title:"Create New Permission",size:"md",showFooter:!1,children:e.jsx(ne,{onSubmit:a})})},E=[{title:"Total Permissions",value:r.length,Icon:D,description:"Active permissions in system",trend:"+2.5%",trendUp:!0},{title:"User Groups",value:8,Icon:U,description:"Groups with permissions",trend:"+1.2%",trendUp:!0},{title:"Access Levels",value:new Set(r.map(o=>o.permissionID)).size,Icon:ee,description:"Different access levels",trend:"+3.4%",trendUp:!0},{title:"Modules",value:12,Icon:re,description:"Protected modules",trend:"+1.8%",trendUp:!0}];return d?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(q,{})}):u?e.jsx("div",{children:"Error loading permissions"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(K,{items:B.threeTier("Access Management","/access-management","Permissions")}),e.jsx(z,{title:"Permissions",description:"Manage system permissions and access controls",actions:e.jsxs(p,{onClick:n,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Add Permission"]})}),e.jsx(G,{cards:E}),e.jsx(_.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(H,{data:r,columns:m,loading:d,tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{je as default};
