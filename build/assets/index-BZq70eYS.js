import{b as F,t as w,j as e,a as p,r as x,c as h,S,U as M,P as T,m as I,d as f}from"./index-C2Q_LmeJ.js";import{B as L,a as D,P as U}from"./pageHeader-7vhK00zh.js";import{D as B}from"./index-CvxHYYsL.js";import{u as K}from"./modal-helpers-CaXMt30Z.js";import{C as k}from"./card-grid-CZ4tobzV.js";import{u as G,a as q,F as z,b as y,c as j,d as b,e as g,f as P}from"./form-CcMvRR1f.js";import{u as Q}from"./useMutation-TZLAPFAD.js";import{P as H,p as _,u as $}from"./permission.queries-CcQJMFaF.js";import{s as O,o as C,a as v,b as R}from"./index-DyAPY9a1.js";import{I as V}from"./input-fvZZM-h7.js";import{T as J}from"./textarea-BuBMhKBk.js";import{T as W}from"./trash-2-PgzqsL3V.js";import{P as A}from"./plus-BFloapdy.js";import{L as X}from"./loader-circle-BgVhgLVT.js";import{L as Y}from"./lock-DGEHZT47.js";import{F as Z}from"./file-check-2Nx5Pqz0.js";import{f as ee}from"./format-CBpsKyOP.js";import"./table-CAIVgxvw.js";import"./dialog-BxdRvcNA.js";import"./select-K8uUziWX.js";import"./arrow-left-DT7SArHl.js";import"./arrow-right-Ct_-AZHB.js";import"./card-CVylEmF3.js";import"./popover-CI77UgAE.js";import"./globe-C44rbEdp.js";import"./utils-km2FGkQ4.js";import"./useQuery-CUE0UVvY.js";const se=()=>{const r=F();return Q({mutationFn:i=>H.createPermission(i),onSuccess:()=>{r.invalidateQueries({queryKey:_.all}),w.success("Permission created successfully")}})},re=C({title:v().min(1,"Permission name is required"),description:v().min(10,"Description must be at least 10 characters")}),ie=C({permissions:R(re).min(1,"Add at least one permission")}),N={title:"",description:""};function te({onSubmit:r,loading:i=!1}){const s=G({resolver:O(ie),defaultValues:{permissions:[N]}}),{fields:c,append:t,remove:u}=q({control:s.control,name:"permissions"}),d=m=>{const a=m.permissions.map(o=>({title:o.title}));r(a),s.reset()};return e.jsx(z,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(d),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:c.map((m,a)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(y,{control:s.control,name:`permissions.${a}.title`,render:({field:o})=>e.jsxs(j,{children:[e.jsx(b,{className:"text-gray-700",children:"Permission Name"}),e.jsx(g,{children:e.jsx(V,{placeholder:"Enter permission name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...o})}),e.jsx(P,{className:"text-red-500"})]})}),e.jsx(y,{control:s.control,name:`permissions.${a}.description`,render:({field:o})=>e.jsxs(j,{children:[e.jsx(b,{className:"text-gray-700",children:"Description"}),e.jsx(g,{children:e.jsx(J,{placeholder:"Enter permission description",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",...o})}),e.jsx(P,{className:"text-red-500"})]})})]}),c.length>1&&e.jsx(p,{type:"button",variant:"outline",size:"icon",className:"mt-8 hover:bg-gray-100",onClick:()=>u(a),children:e.jsx(W,{className:"w-4 h-4 text-gray-600"})})]},m.id))}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(p,{type:"button",variant:"outline",className:"hover:bg-gray-100",onClick:()=>t(N),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Add Another"]}),e.jsx(p,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:i,children:i?e.jsx(X,{className:"w-4 h-4 mr-2 animate-spin"}):"Save Permissions"})]})]})})}function Ie(){const[r,i]=x.useState([]),s=se(),c=K(),{data:t,isError:u,isLoading:d}=$();x.useEffect(()=>(t&&i(t.data),()=>{i([])}),[t==null?void 0:t.data]);const m=x.useMemo(()=>[{header:"Permission Name",accessorKey:"title"},{header:"Description",accessorKey:"description"},{header:"Status",accessorKey:"status",cell:({row:n})=>{const l=n.original.status===1;return e.jsxs("span",{className:h("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",l?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:h("w-1.5 h-1.5 rounded-full mr-1.5",l?"bg-green-400":"bg-red-400")}),l?"Active":"Inactive"]})}},{header:"Created On",accessorKey:"date_added",cell:({row:n})=>e.jsx("span",{className:"text-gray-600",children:ee(new Date(n.original.date_added),"dd/MM/yyyy")})}],[]),a=async n=>{try{await s.mutateAsync(n),f.success("Permission(s) created successfully"),c.close()}catch(l){console.error("Error creating permission:",l),f.error("Failed to create permission. Please try again.")}},o=()=>{c.openForm({title:"Create New Permission",size:"md",showFooter:!1,children:e.jsx(te,{onSubmit:a})})},E=[{title:"Total Permissions",value:r.length,Icon:S,description:"Active permissions in system",trend:"+2.5%",trendUp:!0},{title:"User Groups",value:8,Icon:M,description:"Groups with permissions",trend:"+1.2%",trendUp:!0},{title:"Access Levels",value:new Set(r.map(n=>n.permissionID)).size,Icon:Y,description:"Different access levels",trend:"+3.4%",trendUp:!0},{title:"Modules",value:12,Icon:Z,description:"Protected modules",trend:"+1.8%",trendUp:!0}];return d?e.jsx("div",{className:"p-8 space-y-8",children:e.jsx(T,{})}):u?e.jsx("div",{children:"Error loading permissions"}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(L,{items:D.threeTier("Access Control","/access-control","Permissions")}),e.jsx(U,{title:"Permissions",description:"Manage system permissions and access controls",actions:e.jsxs(p,{onClick:o,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Add Permission"]})}),e.jsx(k,{cards:E}),e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsx(B,{data:r,columns:m,loading:d,tableStyle:"border rounded-lg bg-white",tableHeadClassName:"text-[#4A36EC] font-semibold"})})]})}export{Ie as default};
