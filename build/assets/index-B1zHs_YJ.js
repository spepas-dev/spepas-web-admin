import{f as _,r as u,g as w,j as e,F as k,i as f,k as v,l as y,n as b,I as C,o as N,e as L,G as D,p as A,aV as K,U as P,s as V,v as B,w as z,C as T,m as U,D as $,x as I}from"./index-BEfPUQd3.js";import{u as Q}from"./modal-helpers-u5ghZSiS.js";import{u as W}from"./useMutation-CxnX3va-.js";import{S as q,s as H,u as O}from"./sellers.queries-BqwXXlKu.js";import{s as R}from"./zod-DPUoip6C.js";import{u as M,G as E,M as G,I as Z,a as J}from"./esm-Dq51DQsy.js";import{z as p}from"./index-3Gi9B8Cu.js";import{M as F}from"./multi-select-DEp3z63F.js";import{u as X}from"./gopas.queries-jntJAyfW.js";import{u as Y}from"./users.queries-BzwIn2G9.js";import{S as ee}from"./shopping-bag-njn_Y5Y-.js";import{P as se}from"./plus-D6nxsE-o.js";import"./dialog-DfEuW_jS.js";import"./separator-DpEqoi9c.js";import"./circle-x-Bb9PP882.js";const ae=()=>{const i=_();return W({mutationFn:n=>q.registerSeller(n),onSuccess:()=>{i.invalidateQueries({queryKey:H.all})}})},re=p.object({storeName:p.string().min(1,"Store name is required"),longitude:p.number().optional(),latitude:p.number().optional(),Gopa_ID:p.string().min(1,"Please select a Gopa"),User_ID:p.string().min(1,"Please select a user")}),te=["places"];function le({onSubmit:i,loading:n=!1,selectedLocation:a}){const{data:m}=Y(),h=u.useMemo(()=>{var s;return((s=m==null?void 0:m.data)==null?void 0:s.map(r=>({value:r.User_ID,label:r.name})))||[]},[m==null?void 0:m.data]),{data:l}=X(),g=u.useMemo(()=>{var s;return((s=l==null?void 0:l.data)==null?void 0:s.map(r=>({value:r.User_ID,label:r.name})))||[]},[l==null?void 0:l.data]);console.log(l);const{isLoaded:j,loadError:d}=M({googleMapsApiKey:"AIzaSyDLsZ984L00maH7hl__gWQ-v7U-KWOEnfU",libraries:te}),x=u.useMemo(()=>({lat:5.6037,lng:-.187}),[]),o=w({resolver:R(re),defaultValues:{storeName:"",longitude:(a==null?void 0:a.lng)??x.lng,latitude:(a==null?void 0:a.lat)??x.lat,Gopa_ID:"",User_ID:""}}),S=s=>{const r={storeName:s.storeName,Gopa_ID:s.Gopa_ID,longitude:s.longitude||0,latitude:s.latitude||0,User_ID:s.User_ID};i(r),o.reset()};return d?e.jsx("div",{children:"Error loading map"}):j?e.jsx(k,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(S),className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"flex gap-4 items-start",children:e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(f,{control:o.control,name:"storeName",render:({field:s})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-gray-700",children:"Store Name"}),e.jsx(b,{children:e.jsx(C,{placeholder:"Enter store name",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:n,...s})}),e.jsx(N,{className:"text-red-500"})]})}),e.jsx(f,{control:o.control,name:"User_ID",render:({field:s})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-gray-700",children:"Select User"}),e.jsx(b,{children:e.jsx(F,{options:h,value:[s.value],onValueChange:r=>s.onChange(r[0]),placeholder:"Select a User",maxCount:1,disabled:n})}),e.jsx(N,{className:"text-red-500"})]})}),e.jsx(f,{control:o.control,name:"Gopa_ID",render:({field:s})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-gray-700",children:"Select Gopa"}),e.jsx(b,{children:e.jsx(F,{options:g,value:[s.value],onValueChange:r=>s.onChange(r[0]),placeholder:"Select a Gopa",maxCount:1,disabled:n})}),e.jsx(N,{className:"text-red-500"})]})}),e.jsxs("div",{className:"space-y-2",children:[a&&e.jsx("div",{className:"p-2 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-green-700",children:["ðŸ“ Location selected from main map: ",a.lat.toFixed(6),", ",a.lng.toFixed(6)]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(f,{control:o.control,name:"latitude",render:({field:s})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-gray-700",children:"Latitude"}),e.jsx(b,{children:e.jsx(C,{placeholder:"Click on map to select location",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:n,...s,value:s.value||"",onChange:r=>s.onChange(parseFloat(r.target.value)||0)})}),e.jsx(N,{className:"text-red-500"})]})}),e.jsx(f,{control:o.control,name:"longitude",render:({field:s})=>e.jsxs(v,{children:[e.jsx(y,{className:"text-gray-700",children:"Longitude"}),e.jsx(b,{children:e.jsx(C,{placeholder:"Click on map to select location",className:"border-gray-200 focus:border-[#4A36EC] focus:ring-[#4A36EC]",disabled:n,...s,value:s.value||"",onChange:r=>s.onChange(parseFloat(r.target.value)||0)})}),e.jsx(N,{className:"text-red-500"})]})})]})]}),e.jsx("div",{className:"h-[200px] rounded-lg overflow-hidden",children:e.jsx(E,{zoom:13,center:x,mapContainerClassName:"w-full h-full",onClick:s=>{s.latLng&&(o.setValue("latitude",s.latLng.lat()),o.setValue("longitude",s.latLng.lng()))},children:e.jsx(G,{position:{lat:o.watch("latitude")||0,lng:o.watch("longitude")||0}})})})]})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(L,{type:"submit",className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",disabled:n,children:n?"Saving...":"Save Seller"})})]})}):e.jsx("div",{children:"Loading..."})}const ne=["places"];function oe({sellers:i,selectedLocation:n,onLocationSelect:a}){const{isLoaded:m,loadError:h}=M({googleMapsApiKey:"AIzaSyDLsZ984L00maH7hl__gWQ-v7U-KWOEnfU",libraries:ne}),[l,g]=u.useState(null),j=u.useMemo(()=>n||{lat:5.6037,lng:-.187},[n]);return h?e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"text-red-600",children:"Error loading map. Please check your API key."})}):m?e.jsxs(E,{zoom:13,center:j,mapContainerClassName:"w-full h-full",onClick:d=>{d.latLng&&a({lat:d.latLng.lat(),lng:d.latLng.lng()})},children:[i.map((d,x)=>e.jsx(G,{position:{lat:d.sellerDetails.Location.coordinates[0],lng:d.sellerDetails.Location.coordinates[1]},onClick:()=>g(d)},x)),l&&e.jsx(Z,{position:{lat:l.sellerDetails.Location.coordinates[0],lng:l.sellerDetails.Location.coordinates[1]},onCloseClick:()=>g(null),children:e.jsxs("div",{className:"p-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:l.sellerDetails.storeName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Gopa ID: ",l.sellerDetails.Gopa_ID]})]})})]}):e.jsx("div",{className:"h-full flex items-center justify-center bg-gray-100",children:e.jsx("div",{className:"text-gray-600",children:"Loading map..."})})}function Se(){const{data:i,isLoading:n}=O(),a=u.useMemo(()=>(i==null?void 0:i.data)||[],[i==null?void 0:i.data]),[m,h]=u.useState(null),l=u.useMemo(()=>[{header:"Name",accessorKey:"name"},{header:"Email",accessorKey:"email"},{header:"Phone",accessorKey:"phoneNumber"},{header:"User Type",accessorKey:"user_type",cell:({row:t})=>{const c=t.original.user_type;return e.jsx(D,{variant:"outline",children:String(c.charAt(0).toUpperCase()+c.slice(1)).replace(/_/g," ")})}},{header:"Status",accessorKey:"status",cell:({row:t})=>{const c=t.original.status===1;return e.jsxs("span",{className:A("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",c?"bg-green-100 text-green-800 border border-green-200":"bg-red-100 text-red-800 border border-red-200"),children:[e.jsx("span",{className:A("w-1.5 h-1.5 rounded-full mr-1.5",c?"bg-green-400":"bg-red-400")}),c?"Active":"Inactive"]})}},{header:"Verified",accessorKey:"verificationStatus",cell:({row:t})=>{const c=t.original.verificationStatus===1;return e.jsx(D,{variant:c?"default":"outline",className:`${c?"bg-green-100 text-green-800 border-green-200":"bg-red-100 text-red-800 border-red-200"}`,children:c?"âœ“ Verified":"âœ— Unverified"})}}],[]),g=Q(),[j,d]=u.useState(null),x=()=>{g.openForm({title:"Add New Seller",children:e.jsx(le,{onSubmit:s,loading:!1,selectedLocation:j}),showFooter:!1})},o=t=>{h(t),d(t),I.success(`Location selected: ${t.lat.toFixed(6)}, ${t.lng.toFixed(6)}`)},{mutateAsync:S}=ae(),s=async t=>{try{console.log(t);const c=await S(t);I.success(`${c.data.sellerDetails.storeName} created successfully`)}catch{I.error(`Failed to create seller ${t.storeName}`)}finally{g.close()}},r=[{title:"Total Sellers",value:a.length,Icon:K,description:"Registered sellers",trend:"+3.2%",trendUp:!0},{title:"Active Locations",value:a.length,Icon:J,description:"Service locations",trend:"+2.1%",trendUp:!0},{title:"Assigned Gopas",value:new Set(a.map(t=>t.sellerDetails.Gopa_ID).filter(Boolean)).size,Icon:P,description:"Active Gopas",trend:"+1.5%",trendUp:!0},{title:"Total Products",value:156,Icon:ee,description:"Listed products",trend:"+4.3%",trendUp:!0}];return e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsx(V,{items:B.threeTier("User Management","/user-management","Sellers")}),e.jsx(z,{title:"Sellers",description:"Manage sellers and their locations",actions:e.jsxs(L,{onClick:x,className:"bg-[#4A36EC] hover:bg-[#5B4AEE] text-white",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Add Seller"]})}),e.jsx(T,{cards:r}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-6",children:[e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"lg:col-span-4",children:e.jsx($,{data:a,columns:l,loading:n})}),e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"lg:col-span-2 h-[400px] rounded-lg overflow-hidden border",children:e.jsx(oe,{sellers:a,selectedLocation:m,onLocationSelect:o})})]})]})}export{Se as default};
